/*amstramgramVideoPlayer.js--@version:1.0.0--@licence:MIT--@url:https://github.com/Amstramgram75/Amstramgram-Video-Player*/
const e=window,t=document,a=e.PointerEvent?"pointer":e.TouchEvent?"touch":"mouse",s="touch"==a?"none":a+"enter",n="touch"==a?"none":a+"leave",i="touch"==a?"touchstart":a+"down",o="touch"==a?"touchend":a+"up",r=a+"move",l=e.navigator.userAgent.toLowerCase(),u=/ipad|iphone|ipod/i.test(l)&&!e.MSStream||/android/i.test(l);null==Element.prototype.getAttributeNames&&(Element.prototype.getAttributeNames=function(){for(var e=this.attributes,t=e.length,a=new Array(t),s=0;s<t;s++)a[s]=e[s].name;return a});const m=function(){try{let t="__storage_test__";return e.sessionStorage.setItem(t,t),e.sessionStorage.removeItem(t),e.sessionStorage}catch(e){return!1}}();let d,c;if(m&&m.getItem("amst_timeWidth"))d=m.getItem("amst_timeWidth"),c=m.getItem("amst_longTimeWidth");else{const e=t.createElement("div"),a=t.createElement("div");e.classList.add("amst__measureTime"),e.innerHTML="<span>00:00<span>",a.classList.add("amst__measureTime"),a.innerHTML="<span>00:00:00<span>",t.body.appendChild(e),t.body.appendChild(a),d=e.offsetWidth+2,c=a.offsetWidth+2,t.body.removeChild(e),t.body.removeChild(a),m&&(m.setItem("amst_timeWidth",d),m.setItem("amst_longTimeWidth",c))}const p=t.createElement("style");p.appendChild(t.createTextNode("")),t.head.appendChild(p),p.sheet.insertRule(`.amst__time>span{width:${d}px;`,0),p.sheet.insertRule(`.amst__long .amst__time>span{width:${c}px;`,0);let v,h,_=!1;if(m&&null!=m.getItem("amst_fullscreenAPI")?_=JSON.parse(m.getItem("amst_fullscreenAPI")):(_=function(){let e,a=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenchange"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitfullscreenchange"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitfullscreenchange"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozfullscreenchange"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","MSFullscreenChange"]],s=0,n=a.length,i={};for(;s<n;s++)if((e=a[s])&&e[1]in t){for(s=0;s<e.length;s++)i[a[0][s]]=e[s];return i}return!1}(),m.setItem("amst_fullscreenAPI",JSON.stringify(_))),m&&null!=m.getItem("amst_transitionPrefix")&&null!=m.getItem("amst_transformPrefix"))v=m.getItem("amst_transitionPrefix"),h=m.getItem("amst_transformPrefix");else{let e=function(e){let a=t.createElement("div"),s="";for(let t=0;t<e.length;++t){if(void 0!==a.style[e[t]]){s=e[t];break}s=null}return s};v=e(["transition","msTransition","MozTransition","WebkitTransition","OTransition"]),h=e(["transform","msTransform","MozTransform","WebkitTransform","OTransform"]),m.setItem("amst_transitionPrefix",v),m.setItem("amst_transformPrefix",h)}let f="unknown";if(m&&m.getItem("amst_pointerType"))f=m.getItem("amst_pointerType");else{const t=function(e){f=e.pointerType?e.pointerType:"mouse",s()},a=function(){f="touch",s()},s=function(){m.setItem("amst_pointerType",f),e.removeEventListener(r,t),e.removeEventListener("touchstart",a),g.players.length>0&&g.players.forEach(e=>e.container.dispatchEvent(new CustomEvent("pointerDetected")))};e.addEventListener(r,t,!1)}let b=!1;m&&m.getItem("amst_supportPassiveEvents")?b=m.getItem("amst_supportPassiveEvents"):t.createElement("div").addEventListener("test",()=>{},{get passive(){return b=!0,m.setItem("amst_supportPassiveEvents",b),!1}});class g{static options(e){0==g.players.length&&(g.defaultOptions=L(g.defaultOptions,e))}constructor(l,d){const c=["autoplay","loop","muted","playsinline"];let p=c.concat(["crossorigin","poster","preload","src"]);this.params=l.getAttributeNames().reduce((e,t)=>(p.includes(t)&&(e[t]=!!c.includes(t)||l.getAttribute(t)),e),{}),this.params.muted&&(this.params.volume=0,delete this.params.muted),parseInt(l.getAttribute("width"))>0&&parseInt(l.getAttribute("height"))>0&&(this.params.format=parseInt(l.getAttribute("width"))/parseInt(l.getAttribute("height"))),p=p.filter(e=>"muted"!=e).concat(["download","duration","format","fullscreen","hideControlsDelay","next","onInit","previous","skipTime","thumbnails","videoVolumeOrientation","volume","volumeButton","volumeForced","volumeGroup","railMinWidthForNormalUI"]),d&&(d=Object.keys(d).filter(e=>p.includes(e)).reduce((e,t)=>(e[t]=d[t],e),{})),d&&(this.params=L(this.params,d)),this.params=L(g.defaultOptions,this.params);const T=t.createElement("div"),A="horizontal"==this.params.videoVolumeOrientation?"horizontal":"vertical",C=b;T.classList.add("amst__wrapper"),T.classList.add("amst__video"),T.innerHTML=function(e){let t="",a="";u||(a=`\n      <div class="amst__volume-slider" aria-label="${e.volumeSliderLabel}" aria-valuemin="0" aria-valuemax="100" aria-valuenow="100" aria-valuetext="100%" role="slider" aria-orientation="${e.videoVolumeOrientation}" tabindex="0" title="${e.volumeHelpLabel}">\n        <span class="amst__offscreen">${e.volumeHelpLabel}</span>\n        <div class="amst__volume-total">\n          <div class="amst__volume-current" style="height: 100%;"></div>`,"horizontal"!=e.videoVolumeOrientation&&(a+='<div class="amst__volume-handle" style="bottom: 100%; margin-bottom: -3px;"></div>'),a+="</div></div>");t='\n    <div class="amst__button amst__volumebutton">\n      <button type="button" tabindex="0"></button>',"horizontal"!=e.videoVolumeOrientation?t+=a+"</div>":t+="</div>"+a;let s=`\n    <span class="amst__offscreen">${e.appLabel}</span>\n    <div class="amst__container" tabindex="0" role="application" aria-label="${e.appLabel}">\n      <div class="amst__mediaelement">\n        <video></video>\n      </div>\n    <div class="amst__layers">\n      <div class="amst__layer-poster">\n        <canvas></canvas>\n      </div>\n      <div class="amst__layer-loading">\n        <div class="amst__loading">\n          <span class="amst__svg"></span>\n        </div>\n      </div>\n      <div class="amst__layer-play">\n        <div class="amst__svg" role="button" tabindex="0" aria-label="${e.playLabel}" aria-pressed="false"></div>\n      </div>\n      <div class="amst__layer-seeking-touch">\n        <div class="amst__seeking-touch-cache"></div>\n        <span class="amst__time amst__seeking-touch">\n          <span></span>\n        </span>\n      </div>\n    </div>\n    <div class="amst__controls">\n      <div class="amst__button amst__previous">\n        <button type="button" title="${e.previous.label}" aria-label="${e.previous.label}" tabindex="0"></button>\n      </div>\n      <div class="amst__button amst__playpause">\n        <button type="button" title="${e.playLabel}" aria-label="${e.playLabel}" tabindex="0"></button>\n      </div>\n      <div class="amst__button amst__next">\n        <button type="button" title="${e.next.label}" aria-label="${e.next.label}" tabindex="0"></button>\n      </div>\n      <div class="amst__time" role="timer" aria-live="off">\n        <span class="amst__currenttime">00:00</span>\n      </div>\n      <div class="amst__rail">\n        <span class="amst__slider" role="slider" tabindex="0">\n          <span class="amst__buffering-bar"></span>\n          <canvas class="amst__loaded-bar"></canvas>\n          <span class="amst__currenttime-bar"></span>\n          <span class="amst__handle"><span></span></span>\n          <span class="amst__cursor"><span></span></span>\n          <span class="amst__seeking-wrapper">\n            <span class="amst__time amst__seeking">\n              <span>00:00</span>\n            </span>\n          </span>\n        </span>\n      </div>\n      <div class="amst__time amst__time-duration">\n        <span class="amst__duration">00:00</span>\n      </div>`;s+=t,_&&(s+=`        \n      <div class="amst__button amst__fullscreen">\n        <button type="button" title="${e.fullscreen.label}" aria-label="${e.fullscreen.label}" tabindex="0"></button>\n      </div>`);return s+=`\n      <div class="amst__button amst__download">\n        <button type="button" title="${e.download.label}" aria-label="${e.download.label}" tabindex="0"></button>\n      </div>\n    </div>\n  `}(this.params),l.parentNode.insertBefore(T,l),l.setAttribute("src",""),l.parentNode.removeChild(l);const I=this,M=x(T),P=k(T),B=this.media=M("video"),$=this.container=M(".amst__container"),F=M(".amst__layer-poster"),z=M(".amst__layer-poster canvas"),O=M(".amst__layer-seeking-touch"),S=M(".amst__seeking-touch"),N=M(".amst__layer-play"),W=M(".amst__layer-loading"),H=M(".amst__controls"),X=2*H.css("padding-left"),q=M(".amst__playpause>button"),R=M(".amst__rail"),D=M(".amst__slider"),G=M(".amst__handle"),j=M(".amst__currenttime-bar"),V=M(".amst__seeking"),U=M(".amst__volumebutton button"),Y=M(".amst__volume-slider");let J,Q,K,Z,ee,te,ae,se,ne,ie,oe,re,le,ue,me,de=0,ce=0,pe=!1,ve=!1,he=!1,_e=0;function fe(){let e=B.play();e&&e.catch(()=>{setTimeout(()=>{(e=B.play()).catch(()=>be())},50)}),g.currentPlayer&&g.currentPlayer!=I&&g.currentPlayer.reset(),g.currentPlayer=I,$.focus(),q.setAttributes({class:"amst__pause",title:I.params.pauseLabel,"aria-label":I.params.pauseLabel}),N.classList.add("amst__hidden"),pe||ge({detail:{delayed:!0}})}function be(){B.pause(),q.setAttributes({class:"",title:I.params.playLabel,"aria-label":I.params.playLabel}),N.classList.remove("amst__hidden"),ye(),$.focus()}function ge(e){let t=!!e&&e.detail.delayed,a=!!e&&e.detail.forced;B.paused&&!a||(t||ve||pe?(ie&&clearTimeout(ie),ie=setTimeout(()=>ge(),I.params.hideControlsDelay)):($.focus(),H.style[h]="translateX(-50%) scaleY(0)",he=!0))}function ye(){ie&&clearTimeout(ie),H.style[h]="",he=!1,B.paused||ge({detail:{delayed:!0}})}function Ee(){window.location=I.src.substring(0,I.src.lastIndexOf("/"))+"/index.php?file="+I.src.substring(I.src.lastIndexOf("/")+1)}function we(e,t){const a=e.toLowerCase(),s=M(`.amst__${a}`),n=M(`.amst__${a} > button`);!0===I.params[e].disabled?n.setAttribute("disabled",""):n.removeAttribute("disabled"),!0===I.params[e].hidden?s.classList.add("amst__hidden"):s.classList.remove("amst__hidden"),"volumeButton"==e&&Y&&(!0===I.params.volumeButton.disabled||!0===I.params.volumeButton.hidden?Y.classList.add("amst__hidden"):Y.classList.remove("amst__hidden")),n.setAttributes({title:t,"aria-label":t}),Se()}function Te(){we("previous",I.params.previous.label)}function Le(){we("next",I.params.next.label)}function xe(){!1===I.params.download.disabled&&!1===I.params.download.hidden?M(".amst__download>button").on("click",Ee,!1):M(".amst__download>button").off("click",Ee),we("download",I.params.download.label)}function ke(){ue=I.params.fullscreen.label.enter,me=I.params.fullscreen.label.exit,we("fullscreen",g.currentFullScreenPlayer==I?me:ue)}function Ae(){we("volumeButton",0==I.volume?I.params.volumeButton.label.unmute:I.params.volumeButton.label.mute)}function Ce(e){let t=e.detail;t="object"==typeof t?t:{src:t},isNaN(t.volume)||!0!==t.volumeForced&&m.getItem(`amst_volumegroup${t.volumeGroup}`)?m.getItem(`amst_volumegroup${t.volumeGroup}`)&&(I.params.volume=m.getItem(`amst_volumegroup${t.volumeGroup}`)):(I.params.volume=t.volume,m.setItem(`amst_volumegroup${t.volumeGroup}`,t.volume));const a=["autoplay","crossorigin","download","duration","format","fullscreen","loop","next","playsinline","poster","preload","previous","src","skipTime","thumbnails","volumeButton","volumeGroup"];if(t=a.reduce((e,s)=>(a.includes(s)&&null!=t[s]&&(e[s]=t[s]),e),{}),B.getAttribute("src")){for($.classList.add("amst_container_transition"),I.media.pause(),ce=0,de=0,ne=void 0;B.attributes.length>0;)B.removeAttribute(B.attributes[0].name);["autoplay","crossorigin","loop","playsinline","thumbnails"].forEach(e=>I.params[e]=g.defaultOptions[e]),$.classList.remove("amst__thumbnails","amst__loadedmetadata"),_e=0,oe=void 0,V.removeAttribute("style"),re=void 0,S.removeAttribute("style"),I.params=L(I.params,t)}if(I.params.thumbnails.src){let e=new Image;const t=function(a){if(e.removeEventListener("load",t),e.removeEventListener("error",t),"load"==a.type){$.classList.add("amst__thumbnails"),_e=e.naturalWidth/I.params.thumbnails.number;let t={width:`${e.naturalWidth/I.params.thumbnails.number}px`,height:`${e.naturalHeight}px`,"background-image":`url("${I.params.thumbnails.src}")`};V.css(t),S.css(t)}else I.params.thumbnails.src=void 0};e.addEventListener("error",t,!1),e.addEventListener("load",t,!1),e.src=I.params.thumbnails.src}let s={src:I.params.src,preload:u?"none":I.params.preload};!0===I.params.playsinline&&(s.playsinline="",s["webkit-playsinline"]=""),!0===I.params.loop&&(s.loop=""),I.params.crossorigin&&(s.crossorigin=I.params.crossorigin),B.setAttributes(s),I.volume=u&&I.params.volume>0?1:I.params.volume,le||(le=0==B.volume?.1:B.volume,u&&(le=1)),$.style.paddingBottom=1/I.params.format*100+"%",I.params.poster&&(F.style.backgroundImage=`url("${I.params.poster}")`,F.classList.remove("amst__hidden")),M(".amst__duration").innerHTML=y(I.params.duration),M(".amst__currenttime").innerHTML=y(0,I.params.duration>3600),Te(),Le(),xe(),Ae(),_&&ke(),!0===I.params.autoplay&&fe()}this.events={next:[],previous:[]},$.on("amstEvent__play",fe,!1),$.on("amstEvent__pause",be,!1),$.on("amstEvent__reset",(function(){z.width=B.videoWidth,z.height=B.videoHeight,z.getContext("2d").drawImage(B,0,0,z.width,z.height),F.classList.remove("amst__hidden"),$.classList.remove("amst__loadedmetadata"),B.src="",B.preload="none",B.src=I.params.src}),!1),$.on("amstEvent__hideControls",ge,!1),$.on("amstEvent__showControls",ye,!1),M(".amst__next").on("click",(function(){[...I.events.next].forEach(e=>e.bind(this))})),M(".amst__previous").on("click",(function(){[...I.events.previous].forEach(e=>e.bind(this))})),M(".amst__next").on("click",(function(){[...I.events.next].forEach(e=>e.apply(this))})),M(".amst__previous").on("click",(function(){[...I.events.previous].forEach(e=>e.apply(this))})),$.on("amstEvent__previousButton",Te,!1),$.on("amstEvent__nextButton",Le,!1),$.on("amstEvent__fullscreenButton",ke,!1),$.on("amstEvent__downloadButton",xe,!1),$.on("amstEvent__volumeButton",Ae,!1),$.on("amstEvent__src",Ce,!1),Ce({detail:this.params}),B.on("mousemove",()=>ye(),!!C&&{passive:!0}).on("loadedmetadata",()=>{let t=this.params.format=B.videoWidth/B.videoHeight;g.currentFullScreenPlayer==I?e.dispatchEvent(new CustomEvent("optimizedResize")):$.style.paddingBottom=1/t*100+"%",$.classList.add("amst__loadedmetadata"),B.currentTime=de}).on("loadeddata",()=>{B.currentTime=de}).on("durationchange",()=>{this.params.duration=B.duration,se="string"==typeof this.params.skipTime&&"%"==this.params.skipTime.slice(-1)?parseFloat(this.params.skipTime)*B.duration/100:parseFloat(this.params.skipTime),B.duration>=3600?$.classList.add("amst__long"):$.classList.remove("amst__long"),D.setAttribute("aria-valuemax",B.duration),M(".amst__duration").innerHTML=y(B.duration),M(".amst__currenttime").innerHTML=y(de,B.duration>3600),Se()}).on("progress",Be).on("timeupdate",()=>{if(isNaN(B.duration))return;Be(),D.setAttribute("aria-valuenow",B.currentTime);let e=Math.floor(B.currentTime);if(de!=e){let t=y(de=e,B.duration>3600);M(".amst__currenttime").innerHTML=t,D.setAttribute("aria-valuetext",t)}(0==ce||Math.abs(B.currentTime-ce)>.5)&&(cancelAnimationFrame(ae),Fe()),ce=B.currentTime}).on("ended",()=>{B.currentTime=0,this.pause()}).on("pause",()=>cancelAnimationFrame(ae)).on("playing",()=>{ce=0,F.classList.add("amst__hidden")}).on("seeked",()=>{0==de&&this.paused&&(z.width=0,z.height=0,F.classList.remove("amst__hidden"))}).on("play playing seeked canplay",()=>{ve=!1,$.classList.remove("amst__buffering")}).on("seeking waiting loadeddata",()=>{ve=!0,$.classList.add("amst__buffering")});const Ie=M(".amst__loaded-bar"),Me=Ie.offsetHeight;let Pe=Ie.getContext("2d");function Be(){if(!function(e,t){if(!e||!t||e.length!=t.length)return!1;for(let a=0;a<e.length;a++)if(e.start(a)!=t.start(a)||e.end(a)!=t.end(a))return a=e.length,!1;return!0}(B.buffered,ne)){Pe.clearRect(0,0,Ie.width,Ie.height);let e=Ie.width/B.duration;for(let t=0;t<B.buffered.length;t++){let a=B.buffered.start(t)*e,s=B.buffered.end(t)*e-a;new E(Pe,Me,a,s)}ne=B.buffered}}Ie.height=Me,Pe.fillStyle=Ie.css("color");let $e=.5*G.offsetWidth;function Fe(){let e=B.paused&&!B.seeking?"all .15s ease-in":"none",t=B.currentTime,a=B.duration,s=isNaN(a)?0:(t/a).toFixed(4),n=s*Z-$e;n=Math.max(n,0),n=Math.min(n,Z-2*$e)+"px",B.paused?(j.css({[v]:e,[h]:`scaleX(${s})`}),G.css({[v]:e,[h]:`translateX(${n})`})):(j.css({[v]:e,[h]:`scaleX(${s})`}),G.css({[v]:e,[h]:`translateX(${n})`}),ae=requestAnimationFrame(Fe))}function ze(e){let t=((e.changedTouches?e.changedTouches[0].clientX:e.clientX)-K)/Z;B.currentTime=t*B.duration}function Oe(e){I.paused||pe||ge({detail:{delayed:!0}}),ze(e),R.off(r,ze),R.off(o+" "+n,Oe)}if(P([B,W,O,N]).on("touchstart",(function(e){const t=M(e.target),a=(new Date).getTime(),s=200,n=B.duration?B.currentTime/B.duration:void 0;let i=e.changedTouches[0].pageX,o=e.changedTouches[0].pageY,r=0,l=0,u=0,m=void 0,d=!1;function c(e){if(B.duration&&!(I.paused&&u<-5))if(d)e.preventDefault();else{if(u>-5&&e.preventDefault(),r=e.changedTouches[0].pageX-i,l=e.changedTouches[0].pageY-o,Math.abs(r)>Math.abs(l)?u++:u--,u>=5){m=Math.min(Math.max(n+r/J,0),.999),re||(re=S.offsetWidth);const e=Math.min(Math.max(m*J-.5*re,0),J-re)+"px";let t={[h]:`translateX(${e})`};I.params.thumbnails.src&&(t.backgroundPosition=-Math.floor(100*m)*_e+"px 0"),S.css(t),M(".amst__seeking-touch-cache").style[h]=`scaleX(${m})`,M(".amst__seeking-touch > span").innerHTML=y(B.duration*m,B.duration>3600),5==u&&(O.classList.add("amst__show"),ge({detail:{delayed:!1,forced:!0}}))}-5==u&&(l<0?he&&(ye(),d=!0):he||(ge(),d=!0))}}t.on("touchend",(function e(n){null!=m?(B.currentTime=B.duration*m,O.classList.remove("amst__show"),ye()):d||s>(new Date).getTime()-a&&I.togglePlayPause();t.off("touchend",e);t.off("touchmove",c)}),!!C&&{passive:!0}),t.on("touchmove",c,!!C&&{passive:!1})}),!!C&&{passive:!1}),P([B,W]).on("click",()=>this.pause(),!1),$.on("touchstart mousedown",()=>{$.classList.remove("amst__keyboard-active")},!!C&&{passive:!0}),M(".amst__playpause").on("click",()=>this.togglePlayPause()),N.on("click",()=>this.play()),H.on(s,e=>{if("touch"==a||e.pointerType&&"touch"==e.pointerType)return!1;ye(),pe=!0}).on(n,e=>{if("touch"==a||e.pointerType&&"touch"==e.pointerType)return!1;pe=!1,ge({detail:{delayed:!0}})}),R.on(i,()=>{if(isNaN(B.duration))return!1;R.on(r,ze,!!C&&{passive:!0}),R.on(o+" "+n,Oe,!1)},!!C&&{passive:!0}),w(r,"optimizedPointerMove",D),D.on("optimizedPointerMove",e=>{if("touch"==a||e.pointerType&&"touch"==e.pointerType||isNaN(B.duration))return!1;oe||(oe=V.offsetWidth);let t=e.detail.clientX-K;const s=t/Z,n=-Math.floor(100*s)*_e+"px",i=.5*oe-6;I.params.thumbnails.src&&(V.style.backgroundPosition=n+" 0"),M(".amst__cursor").style[h]=`translateX(${t}px)`,t=Math.max(t,i),t=Math.min(t,Z-i),M(".amst__seeking-wrapper").style[h]=`translateX(${t}px)`,M(".amst__seeking > span").innerHTML=y(s*B.duration,B.duration>3600)}),B.on("volumechange",()=>{if(!u){const e=parseInt(100*B.volume);Y.setAttributes({"aria-valuenow":e,"aria-valuetext":e+"%"}),"horizontal"==A?M(".amst__volume-current").style.width=e+"%":M(".amst__volume-handle").style.bottom=e+"%"}0==B.volume?(B.muted=!0,U.setAttributes({title:I.params.volumeButton.label.unmute,"aria-label":I.params.volumeButton.label.unmute,class:"amst__unmute"})):(B.muted=!1,le=B.volume,U.classList.contains("amst__unmute")&&(U.removeAttribute("class"),U.setAttributes({title:I.params.volumeButton.label.mute,"aria-label":I.params.volumeButton.label.mute}))),m&&I.params.volumeGroup>-1&&m.setItem(`amst_volumegroup${I.params.volumeGroup}`,I.volume),I.params.volume=I.volume,I.params.volumeGroup>-1&&g.players.length>1&&g.players.forEach(e=>{e!=I&&e.params.volumeGroup==I.params.volumeGroup&&e.volume!=I.volume&&(e.volume=I.volume)})}),U.on("click",()=>{B.muted?(B.volume=le,B.muted=!1):(B.volume=0,B.muted=!0)}),!u){Y.on(i,()=>{Y.on(r,e).on(n,a).on(o,e).on(o,a)});const e=function(e){let t;"horizontal"==A?(t=Math.max(0,e.clientX-Q.left),t=(t/=Q.width)>.96?1:t):(Y.style.cursor="ns-resize",t=Q.height-e.clientY+Q.top,t=Math.max(0,Math.min(t,100))/100),I.volume=t},a=function(){Y.off(r,e).off(n,a).off(o,e).off(o,a),"vertical"==A&&(Y.style.cursor="")};$.on("keydown",(function(e){switch($.classList.add("amst__keyboard-active"),ye(),[37,38,39,40,77].includes(e.which)&&e.preventDefault(),e.which>36&&e.which<41&&(38!=e.which&&40!=e.which||t.activeElement==Y||("vertical"==A?(Y.on("transitionend",(function e(){this.removeEventListener("transitionend",e),this.focus()})),U.focus()):Y.focus()),37!=e.which&&39!=e.which||t.activeElement==D||D.focus()),e.which){case 77:!0!==I.params.volumeButton.disabled&&!0!==I.params.volumeButton.hidden&&(U.dispatchEvent(new MouseEvent("click")),U.focus());break;case 40:!0!==I.params.volumeButton.disabled&&!0!==I.params.volumeButton.hidden&&(I.volume=Math.max(0,I.volume-.05));break;case 38:!0!==I.params.volumeButton.disabled&&!0!==I.params.volumeButton.hidden&&(I.volume=Math.min(1,I.volume+.05));break;case 37:I.currentTime=Math.max(0,I.currentTime-se);break;case 39:I.currentTime=Math.min(I.duration,I.currentTime+se);break;case 32:if(t.activeElement==q)return;"BUTTON"!=t.activeElement.nodeName&&(e.preventDefault(),I.togglePlayPause())}}),!1)}if(_){let a=0,s=0;const n=M(".amst__fullscreen>button");n.on("click",()=>{null!==t[_.fullscreenElement]?t[_.exitFullscreen]():(a=e.pageXOffset,s=e.pageYOffset,T[_.requestFullscreen](),g.currentFullScreenPlayer=I)}),t.addEventListener(_.fullscreenchange,(function(){t[_.fullscreenElement]==T?(e.addEventListener("optimizedResize",i),T.classList.add("amst__isfullscreen"),$.classList.add("amst__notransition"),n.setAttributes({title:me,"aria-label":me,class:" amst__unfullscreen"}),i()):g.currentFullScreenPlayer==I&&(e.removeEventListener("optimizedResize",i),$.setAttribute("style",`padding-bottom:${1/I.params.format*100}%`),T.classList.remove("amst__isfullscreen"),n.setAttributes({title:ue,"aria-label":ue,class:""}),setTimeout(()=>{e.scroll(a,s),setTimeout(()=>{$.classList.remove("amst__notransition")},50)},50),g.currentFullScreenPlayer=void 0)}),!1);const i=function(){e.innerWidth/e.innerHeight>I.params.format?$.css({width:e.innerHeight*I.params.format+"px",height:"100%",paddingBottom:0}):$.css({width:"100%",height:"auto",paddingBottom:1/I.params.format*100+"%"}),Ne()}}function Se(){te&&clearTimeout(te),te=setTimeout((function(){ee=0,P(".amst__controls>div:not(.amst__rail):not(.amst__hidden):not(.amst__time-duration)").forEach(e=>{e.classList.contains("amst__time")?ee+=2*e.offsetWidth:ee+=e.offsetWidth}),Ne()}),1)}function Ne(){(J=$.offsetWidth)-X-ee<g.defaultOptions.railMinWidthForNormalUI?$.classList.add("amst__compact"):$.classList.remove("amst__compact");let e=D.getBoundingClientRect();if(K=e.left,Z=e.width,Fe(),!u){const e=function(t){Q=M(".amst__volume-total").getBoundingClientRect(),t&&t.target==$&&$.off("transitionend",e)};$.on("transitionend",e,!1),e()}}e.addEventListener("optimizedResize",Ne),e.addEventListener("optimizedScroll",Ne),"unknown"==f?$.addEventListener("pointerDetected",(function e(){$.removeEventListener("pointerDetected",e),"touch"!=f&&$.classList.add("amst__no-touch")}),!1):"touch"!=f&&$.classList.add("amst__no-touch"),g.players.push(this),d&&"function"==typeof d.onInit&&setTimeout((function(){d.onInit.call(I)}),0)}set src(e){this.container.dispatchEvent(new CustomEvent("amstEvent__src",{detail:e}))}get src(){return this.media.getAttribute("src")}get paused(){return this.media.paused}get duration(){return this.media.duration}set currentTime(e){this.media.duration&&e>=0&&e<=this.media.duration&&(this.media.currentTime=e)}get currentTime(){return this.media.currentTime}set volume(e){this.media.volume=e}get volume(){return this.media.volume}pause(){this.container.dispatchEvent(new CustomEvent("amstEvent__pause"))}play(){this.container.dispatchEvent(new CustomEvent("amstEvent__play"))}reset(){this.pause(),this.container.dispatchEvent(new CustomEvent("amstEvent__reset"))}togglePlayPause(){this.paused?this.play():this.pause()}hideControls(e=!1,t=!1){this.container.dispatchEvent(new CustomEvent("amstEvent__hideControls",{detail:{delayed:e,forced:t}}))}showControls(){this.container.dispatchEvent(new CustomEvent("amstEvent__showControls"))}previous(e){T(e)&&(this.params=L(this.params,{previous:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__previousButton")))}next(e){T(e)&&(this.params=L(this.params.next,{next:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__nextButton")))}fullscreen(e){T(e)&&(this.params=L(this.params,{fullscreen:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__fullscreenButton")))}download(e){T(e)&&(this.params=L(this.params,{download:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__downloadButton")))}volumeButton(e){T(e)&&(this.params=L(this.params,{volumeButton:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__volumeButton")))}on(e,t){"next"!=e&&"previous"!=e||this.events[e].push(t)}off(e,t){if("next"==e||"previous"==e){const a=this.events[e].indexOf(t);a>-1&&this.events[e].splice(a,1)}}}function y(e,t){e=Math.round(e);let a=Math.floor(e/3600),s=Math.floor((e-3600*a)/60),n=Math.round(e%60);return(a=a>9?a+":":a>0?"0"+a+":":t?"00:":"")+(s=s>9?s:"0"+s)+":"+(n=n>9?n:"0"+n)}g.currentPlayer=void 0,g.players=[],g.defaultOptions={autoplay:!1,crossorigin:"anonymous",download:{label:"Télécharger",disabled:!1,hidden:!1},duration:120,format:16/9,fullscreen:{label:{enter:"Plein écran",exit:"Quitter le plein écran"},disabled:!1,hidden:!1},loop:!1,next:{label:"Suivant",disabled:!0,hidden:!0},playsinline:!0,poster:void 0,preload:"none",previous:{label:"Précédent",disabled:!0,hidden:!0},skipTime:"1%",thumbnails:{src:void 0,number:100},volume:.8,volumeButton:{label:{mute:"Désactiver le son",unmute:"Activer le son"},disabled:!1,hidden:!1},volumeGroup:0,hideControlsDelay:5e3,videoVolumeOrientation:"vertical",railMinWidthForNormalUI:600,appLabel:"Lecteur Vidéo",pauseLabel:"Pause",playLabel:"Lecture",volumeHelpLabel:"Utilisez les flèches Haut/Bas du clavier pour augmenter ou diminuer le volume.",volumeSliderLabel:"Potentiomètre de volume"};class E{constructor(e,t,a,s){e.beginPath(),e.moveTo(a+2,0),e.lineTo(a+s-2,0),e.quadraticCurveTo(a+s,0,a+s,2),e.lineTo(a+s,0+t-2),e.quadraticCurveTo(a+s,0+t,a+s-2,0+t),e.lineTo(a+2,0+t),e.quadraticCurveTo(a,0+t,a,0+t-2),e.lineTo(a,2),e.quadraticCurveTo(a,0,a+2,0),e.closePath(),e.fill()}}let w=(t,a,s=e)=>{let n=!1;s.addEventListener(t,e=>{n||(n=!0,requestAnimationFrame(()=>{s.dispatchEvent(new CustomEvent(a,{detail:e})),n=!1}))})};function T(e){return e&&"object"==typeof e&&!Array.isArray(e)}function L(e,t){let a=Object.assign({},e);return T(e)&&T(t)&&Object.keys(t).forEach(s=>{T(t[s])&&s in e?a[s]=L(e[s],t[s]):Object.assign(a,{[s]:t[s]})}),a}w("resize","optimizedResize"),w("scroll","optimizedScroll");let x=t=>{return function(a){let s="string"==typeof a?t.querySelector(a):a;return s&&(s.css=t=>{if("string"==typeof t){let a=e.getComputedStyle(s,null).getPropertyValue(t);return isNaN(parseFloat(a))?a:parseFloat(a)}return Object.assign(s.style,t),s},s.setAttributes=e=>{Object.keys(e).forEach(t=>s.setAttribute(t,e[t]))},s.on=function(e,t,a=!1){return e.split(" ").forEach(e=>s.addEventListener(e,t,a)),s},s.off=function(e,t){return e.split(" ").forEach(e=>s.removeEventListener(e,t)),s}),s}},k=e=>{return t=>{let a=Array.isArray(t)?t:Array.from(e.querySelectorAll(t));return a.css=e=>{if("string"==typeof e){let t=window.getComputedStyle(a[0],null).getPropertyValue(e);return isNaN(parseFloat(t))?t:parseFloat(t)}return a.forEach(t=>{Object.assign(t.style,e)}),a},a.on=function(e,t,s=!1){return a.forEach(a=>{e.split(" ").forEach(e=>a.addEventListener(e,t,s))}),a},a.off=function(e,t){return a.forEach(a=>{e.split(" ").forEach(e=>a.removeEventListener(e,t))}),a},a.length?a:null}};export default g;
