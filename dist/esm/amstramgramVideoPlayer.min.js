/*amstramgramVideoPlayer.js--@version:1.0.2--@licence:MIT--@url:https://github.com/Amstramgram75/Amstramgram-Video-Player*/
const e=window,t=document,a=e.PointerEvent?"pointer":e.TouchEvent?"touch":"mouse",s="touch"==a?"none":a+"enter",n="touch"==a?"none":a+"leave",i="touch"==a?"touchstart":a+"down",o="touch"==a?"touchend":a+"up",r=a+"move",l=e.navigator.userAgent.toLowerCase(),u=/ipad|iphone|ipod/i.test(l)&&!e.MSStream||/android/i.test(l);null==Element.prototype.getAttributeNames&&(Element.prototype.getAttributeNames=function(){for(var e=this.attributes,t=e.length,a=new Array(t),s=0;s<t;s++)a[s]=e[s].name;return a});const m=function(){try{let t="__storage_test__";return e.sessionStorage.setItem(t,t),e.sessionStorage.removeItem(t),e.sessionStorage}catch(e){return!1}}();let d,c;if(m&&m.getItem("amst_timeWidth"))d=m.getItem("amst_timeWidth"),c=m.getItem("amst_longTimeWidth");else{const e=t.createElement("div"),a=t.createElement("div");e.classList.add("amst__measureTime"),e.innerHTML="<span>00:00<span>",a.classList.add("amst__measureTime"),a.innerHTML="<span>00:00:00<span>",t.body.appendChild(e),t.body.appendChild(a),d=e.offsetWidth+2,c=a.offsetWidth+2,t.body.removeChild(e),t.body.removeChild(a),m&&(m.setItem("amst_timeWidth",d),m.setItem("amst_longTimeWidth",c))}const p=t.createElement("style");p.appendChild(t.createTextNode("")),t.head.appendChild(p),p.sheet.insertRule(`.amst__time>span{width:${d}px;`,0),p.sheet.insertRule(`.amst__long .amst__time>span{width:${c}px;`,0);const v="undefined"!=typeof window&&window.navigator&&window.navigator.platform&&/iP(ad|hone|od)/.test(window.navigator.platform);let h,_,f;if(m&&null!=m.getItem("amst_fullscreenAPI")?h=JSON.parse(m.getItem("amst_fullscreenAPI")):(h=function(){let e,a=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenchange"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitfullscreenchange"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitfullscreenchange"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozfullscreenchange"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","MSFullscreenChange"]],s=0,n=a.length,i={};for(;s<n;s++)if(e=a[s],e&&e[1]in t){for(s=0;s<e.length;s++)i[a[0][s]]=e[s];return i}return{fake:!0,fullscreenchange:"fullscreenchange"}}(),m.setItem("amst_fullscreenAPI",JSON.stringify(h))),m&&null!=m.getItem("amst_transitionPrefix")&&null!=m.getItem("amst_transformPrefix"))_=m.getItem("amst_transitionPrefix"),f=m.getItem("amst_transformPrefix");else{let e=function(e){let a=t.createElement("div"),s="";for(let t=0;t<e.length;++t){if(void 0!==a.style[e[t]]){s=e[t];break}s=null}return s};_=e(["transition","msTransition","MozTransition","WebkitTransition","OTransition"]),f=e(["transform","msTransform","MozTransform","WebkitTransform","OTransform"]),m.setItem("amst_transitionPrefix",_),m.setItem("amst_transformPrefix",f)}let b="unknown";if(m&&m.getItem("amst_pointerType"))b=m.getItem("amst_pointerType");else{const t=function(e){b=e.pointerType?e.pointerType:"mouse",s()},a=function(){b="touch",s()},s=function(){m.setItem("amst_pointerType",b),e.removeEventListener(r,t),e.removeEventListener("touchstart",a),y.players.length>0&&y.players.forEach(e=>e.container.dispatchEvent(new CustomEvent("pointerDetected")))};e.addEventListener(r,t,!1),e.addEventListener("touchstart",a,!1)}let g=!1;m&&m.getItem("amst_supportPassiveEvents")?g=m.getItem("amst_supportPassiveEvents"):t.createElement("div").addEventListener("test",()=>{},{get passive(){return g=!0,m.setItem("amst_supportPassiveEvents",g),!1}});class y{static options(e){0==y.players.length&&(y.defaultOptions=x(y.defaultOptions,e))}constructor(l,d){const c=["autoplay","loop","muted","playsinline"];let p=c.concat(["crossorigin","poster","preload","src"]);this.params=l.getAttributeNames().reduce((e,t)=>(p.includes(t)&&(e[t]=!!c.includes(t)||l.getAttribute(t)),e),{}),this.params.muted&&(this.params.volume=0,delete this.params.muted),parseInt(l.getAttribute("width"))>0&&parseInt(l.getAttribute("height"))>0&&(this.params.format=parseInt(l.getAttribute("width"))/parseInt(l.getAttribute("height"))),p=p.filter(e=>"muted"!=e).concat(["download","duration","format","fullscreen","hideControlsDelay","next","onInit","previous","skipTime","thumbnails","videoVolumeOrientation","volume","volumeButton","volumeForced","volumeGroup","railMinWidthForNormalUI"]),d&&(d=Object.keys(d).filter(e=>p.includes(e)).reduce((e,t)=>(e[t]=d[t],e),{})),d&&(this.params=x(this.params,d)),this.params=x(y.defaultOptions,this.params);const T=t.createElement("div"),C="horizontal"==this.params.videoVolumeOrientation?"horizontal":"vertical",P=g;T.classList.add("amst__wrapper"),T.classList.add("amst__video"),T.innerHTML=function(e){let t="",a="";u||(a=`\n      <div class="amst__volume-slider" aria-label="${e.volumeSliderLabel}" aria-valuemin="0" aria-valuemax="100" aria-valuenow="100" aria-valuetext="100%" role="slider" aria-orientation="${e.videoVolumeOrientation}" tabindex="0" title="${e.volumeHelpLabel}">\n        <span class="amst__offscreen">${e.volumeHelpLabel}</span>\n        <div class="amst__volume-total">\n          <div class="amst__volume-current" style="height: 100%;"></div>`,"horizontal"!=e.videoVolumeOrientation&&(a+='<div class="amst__volume-handle" style="bottom: 100%; margin-bottom: -3px;"></div>'),a+="</div></div>");t='\n    <div class="amst__button amst__volumebutton">\n      <button type="button" tabindex="0"></button>',"horizontal"!=e.videoVolumeOrientation?t+=a+"</div>":t+="</div>"+a;let s=`\n    <span class="amst__offscreen">${e.appLabel}</span>\n    <div class="amst__container" tabindex="0" role="application" aria-label="${e.appLabel}">\n      <div class="amst__mediaelement">\n        <video></video>\n      </div>\n    <div class="amst__layers">\n      <div class="amst__layer-poster">\n        <canvas></canvas>\n      </div>\n      <div class="amst__layer-loading">\n        <div class="amst__loading">\n          <span class="amst__svg"></span>\n        </div>\n      </div>\n      <div class="amst__layer-play">\n        <div class="amst__svg" role="button" tabindex="0" aria-label="${e.playLabel}" aria-pressed="false"></div>\n      </div>\n      <div class="amst__layer-seeking-touch">\n        <div class="amst__seeking-touch-cache"></div>\n        <span class="amst__time amst__seeking-touch">\n          <span></span>\n        </span>\n      </div>\n    </div>\n    <div class="amst__controls">\n      <div class="amst__button amst__previous">\n        <button type="button" title="${e.previous.label}" aria-label="${e.previous.label}" tabindex="0"></button>\n      </div>\n      <div class="amst__button amst__playpause">\n        <button type="button" title="${e.playLabel}" aria-label="${e.playLabel}" tabindex="0"></button>\n      </div>\n      <div class="amst__button amst__next">\n        <button type="button" title="${e.next.label}" aria-label="${e.next.label}" tabindex="0"></button>\n      </div>\n      <div class="amst__time" role="timer" aria-live="off">\n        <span class="amst__currenttime">00:00</span>\n      </div>\n      <div class="amst__rail">\n        <span class="amst__slider" role="slider" tabindex="0">\n          <span class="amst__buffering-bar"></span>\n          <canvas class="amst__loaded-bar"></canvas>\n          <span class="amst__currenttime-bar"></span>\n          <span class="amst__handle"><span></span></span>\n          <span class="amst__cursor"><span></span></span>\n          <span class="amst__seeking-wrapper">\n            <span class="amst__time amst__seeking">\n              <span>00:00</span>\n            </span>\n          </span>\n        </span>\n      </div>\n      <div class="amst__time amst__time-duration">\n        <span class="amst__duration">00:00</span>\n      </div>`;s+=t,h&&(s+=`        \n      <div class="amst__button amst__fullscreen">\n        <button type="button" title="${e.fullscreen.label}" aria-label="${e.fullscreen.label}" tabindex="0"></button>\n      </div>`);return s+=`\n      <div class="amst__button amst__download">\n        <button type="button" title="${e.download.label}" aria-label="${e.download.label}" tabindex="0"></button>\n      </div>\n    </div>\n  `,s}(this.params),l.parentNode.insertBefore(T,l),l.setAttribute("src",""),l.removeAttribute("src"),l.load(),l.parentNode.removeChild(l);const I=this,M=k(T),B=A(T),F=this.media=M("video"),$=this.container=M(".amst__container"),O=M(".amst__layer-poster"),S=M(".amst__layer-poster canvas"),z=M(".amst__layer-seeking-touch"),N=M(".amst__seeking-touch"),W=M(".amst__layer-play"),H=M(".amst__layer-loading"),X=M(".amst__controls"),q=2*X.css("padding-left"),D=M(".amst__playpause>button"),R=M(".amst__rail"),G=M(".amst__slider"),j=M(".amst__handle"),V=M(".amst__currenttime-bar"),U=M(".amst__seeking"),Y=M(".amst__volumebutton button"),J=M(".amst__volume-slider");let Q,K,Z,ee,te,ae,se,ne,ie,oe,re,le,ue,me,de,ce=0,pe=0,ve=!1,he=!1,_e=!1,fe=0;function be(){$.classList.contains("amst__loadedmetadata")||F.load();let e=F.play();e&&e.catch(()=>{setTimeout(()=>{e=F.play(),e.catch(e=>{ge(),console.log("Error initiating video playback : ",e)})},50)}),y.currentPlayer&&y.currentPlayer!=I&&y.currentPlayer.reset(),y.currentPlayer=I,$.focus(),D.setAttributes({class:"amst__pause",title:I.params.pauseLabel,"aria-label":I.params.pauseLabel}),W.classList.add("amst__hidden"),ve||ye({detail:{delayed:!0}})}function ge(){F.pause(),D.setAttributes({class:"",title:I.params.playLabel,"aria-label":I.params.playLabel}),W.classList.remove("amst__hidden"),Ee(),$.focus()}function ye(e){let t=!!e&&e.detail.delayed,a=!!e&&e.detail.forced;F.paused&&!a||(t||he||ve?(oe&&clearTimeout(oe),oe=setTimeout(()=>ye(),I.params.hideControlsDelay)):($.focus(),X.style[f]="translateX(-50%) scaleY(0)",_e=!0))}function Ee(){oe&&clearTimeout(oe),X.style[f]="",_e=!1,F.paused||ye({detail:{delayed:!0}})}function we(){window.location=I.src.substring(0,I.src.lastIndexOf("/"))+"/index.php?file="+I.src.substring(I.src.lastIndexOf("/")+1)}function Le(e,t){const a=e.toLowerCase(),s=M(`.amst__${a}`),n=M(`.amst__${a} > button`);!0===I.params[e].disabled?n.setAttribute("disabled",""):n.removeAttribute("disabled"),!0===I.params[e].hidden?s.classList.add("amst__hidden"):s.classList.remove("amst__hidden"),"volumeButton"==e&&J&&(!0===I.params.volumeButton.disabled||!0===I.params.volumeButton.hidden?J.classList.add("amst__hidden"):J.classList.remove("amst__hidden")),n.setAttributes({title:t,"aria-label":t}),qe()}function Te(){Le("previous",I.params.previous.label)}function xe(){Le("next",I.params.next.label)}function ke(){!1===I.params.download.disabled&&!1===I.params.download.hidden?M(".amst__download>button").on("click",we,!1):M(".amst__download>button").off("click",we),Le("download",I.params.download.label)}function Ae(){me=I.params.fullscreen.label.enter,de=I.params.fullscreen.label.exit,Le("fullscreen",y.currentFullScreenPlayer==I?de:me)}function Ce(){Le("volumeButton",0==I.volume?I.params.volumeButton.label.unmute:I.params.volumeButton.label.mute)}function Pe(e){let t=e.detail;t="object"==typeof t?t:{src:t},isNaN(t.volume)||!0!==t.volumeForced&&m.getItem(`amst_volumegroup${t.volumeGroup}`)?m.getItem(`amst_volumegroup${t.volumeGroup}`)&&(I.params.volume=m.getItem(`amst_volumegroup${t.volumeGroup}`)):(I.params.volume=t.volume,m.setItem(`amst_volumegroup${t.volumeGroup}`,t.volume));const a=["autoplay","crossorigin","download","duration","format","fullscreen","loop","next","playsinline","poster","preload","previous","src","skipTime","thumbnails","volumeButton","volumeGroup"];if(t=a.reduce((e,s)=>(a.includes(s)&&null!=t[s]&&(e[s]=t[s]),e),{}),F.getAttribute("src")){for($.classList.add("amst_container_transition"),I.media.pause(),pe=0,ce=0,ie=void 0;F.attributes.length>0;)F.removeAttribute(F.attributes[0].name);["autoplay","crossorigin","loop","playsinline","thumbnails"].forEach(e=>I.params[e]=y.defaultOptions[e]),$.classList.remove("amst__thumbnails","amst__loadedmetadata"),fe=0,re=void 0,U.removeAttribute("style"),le=void 0,N.removeAttribute("style"),I.params=x(I.params,t)}if(I.params.thumbnails.src&&!v){let e=new Image;const t=function(a){if(e.removeEventListener("load",t),e.removeEventListener("error",t),"load"==a.type){$.classList.add("amst__thumbnails"),fe=e.naturalWidth/I.params.thumbnails.number;let t={width:`${e.naturalWidth/I.params.thumbnails.number}px`,height:`${e.naturalHeight}px`,"background-image":`url("${I.params.thumbnails.src}")`};U.css(t),N.css(t)}else I.params.thumbnails.src=void 0};e.addEventListener("error",t,!1),e.addEventListener("load",t,!1),e.src=I.params.thumbnails.src}let s={src:I.params.src,preload:u?"none":I.params.preload};!0===I.params.playsinline&&(s.playsinline="",s["webkit-playsinline"]=""),!0===I.params.loop&&(s.loop=""),I.params.crossorigin&&(s.crossorigin=I.params.crossorigin),F.setAttributes(s),I.volume=u&&I.params.volume>0?1:I.params.volume,ue||(ue=0==F.volume?.1:F.volume,u&&(ue=1)),F.dispatchEvent(new CustomEvent("volumechange")),$.style.paddingBottom=1/I.params.format*100+"%",I.params.poster&&(O.style.backgroundImage=`url("${I.params.poster}")`,O.classList.remove("amst__hidden")),M(".amst__duration").innerHTML=E(I.params.duration),M(".amst__currenttime").innerHTML=E(0,I.params.duration>3600),Te(),xe(),ke(),Ce(),h&&Ae(),1==I.params.autoplay&&(F.load(),be())}this.events={next:[],previous:[]},$.on("amstEvent__play",be,!1),$.on("amstEvent__pause",ge,!1),$.on("amstEvent__reset",(function(){S.width=F.videoWidth,S.height=F.videoHeight,S.getContext("2d").drawImage(F,0,0,S.width,S.height),O.classList.remove("amst__hidden"),$.classList.remove("amst__loadedmetadata"),F.src="",F.preload="none",F.load(),F.src=I.params.src}),!1),$.on("amstEvent__hideControls",ye,!1),$.on("amstEvent__showControls",Ee,!1),M(".amst__next").on("click",(function(){[...I.events.next].forEach(e=>e.apply(this))})),M(".amst__previous").on("click",(function(){[...I.events.previous].forEach(e=>e.apply(this))})),$.on("amstEvent__previousButton",Te,!1),$.on("amstEvent__nextButton",xe,!1),$.on("amstEvent__fullscreenButton",Ae,!1),$.on("amstEvent__downloadButton",ke,!1),$.on("amstEvent__volumeButton",Ce,!1),$.on("amstEvent__src",Pe,!1),F.on("mousemove",()=>Ee(),!!P&&{passive:!0}).on("loadedmetadata",()=>{let t=this.params.format=F.videoWidth/F.videoHeight;y.currentFullScreenPlayer==I?e.dispatchEvent(new CustomEvent("amst__optimizedResize")):$.style.paddingBottom=1/t*100+"%",$.classList.add("amst__loadedmetadata"),F.currentTime=ce}).on("loadeddata",()=>{F.currentTime=ce}).on("durationchange",()=>{this.params.duration=F.duration,ne="string"==typeof this.params.skipTime&&"%"==this.params.skipTime.slice(-1)?parseFloat(this.params.skipTime)*F.duration/100:parseFloat(this.params.skipTime),F.duration>=3600?$.classList.add("amst__long"):$.classList.remove("amst__long"),G.setAttribute("aria-valuemax",F.duration),M(".amst__duration").innerHTML=E(F.duration),M(".amst__currenttime").innerHTML=E(ce,F.duration>3600),qe()}).on("progress",Fe).on("timeupdate",()=>{if(isNaN(F.duration))return;Fe(),G.setAttribute("aria-valuenow",F.currentTime);let e=Math.floor(F.currentTime);if(ce!=e){ce=e;let t=E(ce,F.duration>3600);M(".amst__currenttime").innerHTML=t,G.setAttribute("aria-valuetext",t)}(0==pe||Math.abs(F.currentTime-pe)>.5)&&(cancelAnimationFrame(se),Oe()),pe=F.currentTime}).on("ended",()=>{F.currentTime=0,this.pause()}).on("pause",()=>cancelAnimationFrame(se)).on("playing",()=>{pe=0,O.classList.add("amst__hidden")}).on("seeked",()=>{0==ce&&this.paused&&(S.width=0,S.height=0,O.classList.remove("amst__hidden"))}).on("play playing seeked canplay",()=>{he=!1,$.classList.remove("amst__buffering")}).on("seeking waiting loadeddata",()=>{he=!0,$.classList.add("amst__buffering")});const Ie=M(".amst__loaded-bar"),Me=Ie.offsetHeight;let Be=Ie.getContext("2d");function Fe(){if(!function(e,t){if(!e||!t||e.length!=t.length)return!1;for(let a=0;a<e.length;a++)if(e.start(a)!=t.start(a)||e.end(a)!=t.end(a))return a=e.length,!1;return!0}(F.buffered,ie)){Be.clearRect(0,0,Ie.width,Ie.height);let e=Ie.width/F.duration;for(let t=0;t<F.buffered.length;t++){let a=F.buffered.start(t)*e,s=F.buffered.end(t)*e-a;new w(Be,Me,a,s)}ie=F.buffered}}Ie.height=Me,Be.fillStyle=Ie.css("color");let $e=.5*j.offsetWidth;function Oe(){let e=F.paused&&!F.seeking?"all .15s ease-in":"none",t=F.currentTime,a=F.duration,s=isNaN(a)?0:(t/a).toFixed(4),n=s*ee-$e;n=Math.max(n,0),n=Math.min(n,ee-2*$e)+"px",F.paused?(V.css({[_]:e,[f]:`scaleX(${s})`}),j.css({[_]:e,[f]:`translateX(${n})`})):(V.css({[_]:e,[f]:`scaleX(${s})`}),j.css({[_]:e,[f]:`translateX(${n})`}),se=requestAnimationFrame(Oe))}function Se(e){let t=((e.changedTouches?e.changedTouches[0].clientX:e.clientX)-Z)/ee;F.currentTime=t*F.duration}function ze(e){I.paused||ve||ye({detail:{delayed:!0}}),Se(e),R.off(r,Se),R.off(o+" "+n,ze)}if(B([F,H,z,W]).on("touchstart",(function(e){const t=M(e.target),a=(new Date).getTime(),s=200,n=F.duration?F.currentTime/F.duration:void 0;let i=e.changedTouches[0].pageX,o=e.changedTouches[0].pageY,r=0,l=0,u=0,m=void 0,d=!1;function c(e){if(F.duration&&!(I.paused&&u<-5))if(d)e.preventDefault();else{if(u>-5&&e.preventDefault(),r=e.changedTouches[0].pageX-i,l=e.changedTouches[0].pageY-o,Math.abs(r)>Math.abs(l)?u++:u--,u>=5&&!v){m=Math.min(Math.max(n+r/Q,0),.999),le||(le=N.offsetWidth);const e=Math.min(Math.max(m*Q-.5*le,0),Q-le)+"px";let t={[f]:`translateX(${e})`};I.params.thumbnails.src&&(t.backgroundPosition=-Math.floor(100*m)*fe+"px 0"),N.css(t),M(".amst__seeking-touch-cache").style[f]=`scaleX(${m})`,M(".amst__seeking-touch > span").innerHTML=E(F.duration*m,F.duration>3600),5==u&&(z.classList.add("amst__show"),ye({detail:{delayed:!1,forced:!0}}))}-5==u&&(l<0?_e&&(Ee(),d=!0):_e||(ye(),d=!0))}}t.on("touchend",(function e(n){n.preventDefault(),null!=m?(F.currentTime=F.duration*m,z.classList.remove("amst__show"),Ee()):d||s>(new Date).getTime()-a&&I.togglePlayPause();t.off("touchend",e),t.off("touchmove",c)}),!!P&&{passive:!1}),t.on("touchmove",c,!!P&&{passive:!1})}),!!P&&{passive:!1}),B([F,H]).on("click",()=>this.pause(),!1),$.on("touchstart mousedown",()=>{$.classList.remove("amst__keyboard-active")},!!P&&{passive:!0}),M(".amst__playpause").on("click",()=>this.togglePlayPause()),W.on("click",()=>this.play()),X.on(s,e=>{if("touch"==a||e.pointerType&&"touch"==e.pointerType)return!1;Ee(),ve=!0}).on(n,e=>{if("touch"==a||e.pointerType&&"touch"==e.pointerType)return!1;ve=!1,ye({detail:{delayed:!0}})}),R.on(i,()=>{if(isNaN(F.duration))return!1;R.on(r,Se,!!P&&{passive:!0}),R.on(o+" "+n,ze,!1)},!!P&&{passive:!0}),L(r,"optimizedPointerMove",G),G.on("optimizedPointerMove",e=>{if("touch"==a||e.pointerType&&"touch"==e.pointerType||isNaN(F.duration))return!1;re||(re=U.offsetWidth);let t=e.detail.clientX-Z;const s=t/ee,n=-Math.floor(100*s)*fe+"px",i=.5*re-6;I.params.thumbnails.src&&(U.style.backgroundPosition=n+" 0"),M(".amst__cursor").style[f]=`translateX(${t}px)`,t=Math.max(t,i),t=Math.min(t,ee-i),M(".amst__seeking-wrapper").style[f]=`translateX(${t}px)`,M(".amst__seeking > span").innerHTML=E(s*F.duration,F.duration>3600)}),F.on("volumechange",()=>{if(!u){const e=parseInt(100*F.volume);J.setAttributes({"aria-valuenow":e,"aria-valuetext":e+"%"}),"horizontal"==C?M(".amst__volume-current").style.width=e+"%":M(".amst__volume-handle").style.bottom=e+"%"}F.muted?Y.setAttributes({title:I.params.volumeButton.label.unmute,"aria-label":I.params.volumeButton.label.unmute,class:"amst__unmute"}):(ue=F.volume,Y.classList.contains("amst__unmute")&&(Y.removeAttribute("class"),Y.setAttributes({title:I.params.volumeButton.label.mute,"aria-label":I.params.volumeButton.label.mute}))),m&&I.params.volumeGroup>-1&&m.setItem(`amst_volumegroup${I.params.volumeGroup}`,I.volume),I.params.volume=I.volume,I.params.volumeGroup>-1&&y.players.length>1&&y.players.forEach(e=>{e!=I&&e.params.volumeGroup==I.params.volumeGroup&&e.volume!=I.volume&&(e.volume=I.volume)})}),Y.on("click",()=>{F.muted?(F.volume=ue,F.muted=!1):(F.volume=0,F.muted=!0)}),!u){J.on(i,()=>{J.on(r,e).on(n,a).on(o,e).on(o,a)});const e=function(e){let t;"horizontal"==C?(t=Math.max(0,e.clientX-K.left),t/=K.width,t=t>.96?1:t):(J.style.cursor="ns-resize",t=K.height-e.clientY+K.top,t=Math.max(0,Math.min(t,100))/100),I.volume=t},a=function(){J.off(r,e).off(n,a).off(o,e).off(o,a),"vertical"==C&&(J.style.cursor="")};$.on("keydown",(function(e){switch($.classList.add("amst__keyboard-active"),Ee(),[37,38,39,40,77].includes(e.which)&&e.preventDefault(),e.which>36&&e.which<41&&(38!=e.which&&40!=e.which||t.activeElement==J||("vertical"==C?(J.on("transitionend",(function e(){this.removeEventListener("transitionend",e),this.focus()})),Y.focus()):J.focus()),37!=e.which&&39!=e.which||t.activeElement==G||G.focus()),e.which){case 77:!0!==I.params.volumeButton.disabled&&!0!==I.params.volumeButton.hidden&&(Y.dispatchEvent(new MouseEvent("click")),Y.focus());break;case 40:!0!==I.params.volumeButton.disabled&&!0!==I.params.volumeButton.hidden&&(I.volume=Math.max(0,I.volume-.05));break;case 38:!0!==I.params.volumeButton.disabled&&!0!==I.params.volumeButton.hidden&&(I.volume=Math.min(1,I.volume+.05));break;case 37:I.currentTime=Math.max(0,I.currentTime-ne);break;case 39:I.currentTime=Math.min(I.duration,I.currentTime+ne);break;case 32:if(t.activeElement==D)return;"BUTTON"!=t.activeElement.nodeName&&(e.preventDefault(),I.togglePlayPause())}}),!1)}let Ne=0,We=0;const He=M(".amst__fullscreen>button");He.on("click",()=>{y.currentFullScreenPlayer?(y.currentFullScreenPlayer=void 0,h.fake?(T.classList.remove("amst__fakefullscreen"),t.dispatchEvent(new Event(h.fullscreenchange))):t[h.exitFullscreen]()):(Ne=e.pageXOffset,We=e.pageYOffset,y.currentFullScreenPlayer=I,h.fake?(T.classList.add("amst__fakefullscreen"),t.dispatchEvent(new Event(h.fullscreenchange))):T[h.requestFullscreen]())}),t.addEventListener(h.fullscreenchange,(function(){y.currentFullScreenPlayer==I?(e.addEventListener("amst__optimizedResize",Xe),T.classList.add("amst__isfullscreen"),$.classList.add("amst__notransition"),He.setAttributes({title:de,"aria-label":de,class:" amst__unfullscreen"}),Xe()):(e.removeEventListener("amst__optimizedResize",Xe),$.setAttribute("style",`padding-bottom:${1/I.params.format*100}%`),T.classList.remove("amst__isfullscreen"),He.setAttributes({title:me,"aria-label":me,class:""}),setTimeout(()=>{e.scroll(Ne,We),De(),setTimeout(()=>{$.classList.remove("amst__notransition")},50)},50))}),!1);const Xe=function(){e.innerWidth/e.innerHeight>I.params.format?$.css({width:e.innerHeight*I.params.format+"px",height:"100%",paddingBottom:0}):$.css({width:"100%",height:"auto",paddingBottom:1/I.params.format*100+"%"}),De()};function qe(){ae&&clearTimeout(ae),ae=setTimeout((function(){te=0,B(".amst__controls>div:not(.amst__rail):not(.amst__hidden):not(.amst__time-duration)").forEach(e=>{e.classList.contains("amst__time")?te+=2*e.offsetWidth:te+=e.offsetWidth}),De()}),1)}function De(){Q=$.offsetWidth,Q-q-te<y.defaultOptions.railMinWidthForNormalUI?$.classList.add("amst__compact"):$.classList.remove("amst__compact");let e=G.getBoundingClientRect();if(Z=e.left,ee=e.width,Oe(),!u){const e=function(t){K=M(".amst__volume-total").getBoundingClientRect(),t&&t.target==$&&$.off("transitionend",e)};$.on("transitionend",e,!1),e()}}e.addEventListener("amst__optimizedResize",De),e.addEventListener("amst__optimizedScroll",De),"unknown"==b?$.addEventListener("pointerDetected",(function e(){$.removeEventListener("pointerDetected",e),"touch"!=b&&$.classList.add("amst__no-touch")}),!1):"touch"!=b&&$.classList.add("amst__no-touch"),y.players.push(this),Pe({detail:this.params}),d&&"function"==typeof d.onInit&&setTimeout((function(){d.onInit.call(I)}),0)}set src(e){this.container.dispatchEvent(new CustomEvent("amstEvent__src",{detail:e}))}get src(){return this.media.getAttribute("src")}get paused(){return this.media.paused}get duration(){return this.media.duration}set currentTime(e){this.media.duration&&e>=0&&e<=this.media.duration&&(this.media.currentTime=e)}get currentTime(){return this.media.currentTime}set volume(e){this.media.muted=0==e,this.media.volume=e}get volume(){return this.media.volume}pause(){this.container.dispatchEvent(new CustomEvent("amstEvent__pause"))}play(){this.container.dispatchEvent(new CustomEvent("amstEvent__play"))}reset(){this.pause(),this.container.dispatchEvent(new CustomEvent("amstEvent__reset"))}togglePlayPause(){this.paused?this.play():this.pause()}hideControls(e=!1,t=!1){this.container.dispatchEvent(new CustomEvent("amstEvent__hideControls",{detail:{delayed:e,forced:t}}))}showControls(){this.container.dispatchEvent(new CustomEvent("amstEvent__showControls"))}previous(e){T(e)&&(this.params=x(this.params,{previous:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__previousButton")))}next(e){T(e)&&(this.params=x(this.params.next,{next:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__nextButton")))}fullscreen(e){T(e)&&(this.params=x(this.params,{fullscreen:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__fullscreenButton")))}download(e){T(e)&&(this.params=x(this.params,{download:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__downloadButton")))}volumeButton(e){T(e)&&(this.params=x(this.params,{volumeButton:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__volumeButton")))}on(e,t){this.events.hasOwnProperty(e)&&this.events[e].push(t)}off(e,t){if(this.events.hasOwnProperty(e)){const a=this.events[e].indexOf(t);a>-1&&this.events[e].splice(a,1)}}}function E(e,t){e=Math.round(e);let a=Math.floor(e/3600),s=Math.floor((e-3600*a)/60),n=Math.round(e%60);return a=a>9?a+":":a>0?"0"+a+":":t?"00:":"",s=s>9?s:"0"+s,n=n>9?n:"0"+n,a+s+":"+n}y.currentPlayer=void 0,y.players=[],y.defaultOptions={autoplay:!1,crossorigin:"anonymous",download:{label:"Télécharger",disabled:!1,hidden:!1},duration:120,format:16/9,fullscreen:{label:{enter:"Plein écran",exit:"Quitter le plein écran"},disabled:!1,hidden:!1},loop:!1,next:{label:"Suivant",disabled:!0,hidden:!0},playsinline:!0,poster:void 0,preload:"none",previous:{label:"Précédent",disabled:!0,hidden:!0},skipTime:"1%",thumbnails:{src:void 0,number:100},volume:.8,volumeButton:{label:{mute:"Désactiver le son",unmute:"Activer le son"},disabled:!1,hidden:!1},volumeGroup:0,hideControlsDelay:5e3,videoVolumeOrientation:"vertical",railMinWidthForNormalUI:600,appLabel:"Lecteur Vidéo",pauseLabel:"Pause",playLabel:"Lecture",volumeHelpLabel:"Utilisez les flèches Haut/Bas du clavier pour augmenter ou diminuer le volume.",volumeSliderLabel:"Potentiomètre de volume"};class w{constructor(e,t,a,s){e.beginPath(),e.moveTo(a+2,0),e.lineTo(a+s-2,0),e.quadraticCurveTo(a+s,0,a+s,2),e.lineTo(a+s,0+t-2),e.quadraticCurveTo(a+s,0+t,a+s-2,0+t),e.lineTo(a+2,0+t),e.quadraticCurveTo(a,0+t,a,0+t-2),e.lineTo(a,2),e.quadraticCurveTo(a,0,a+2,0),e.closePath(),e.fill()}}let L=(t,a,s=e)=>{let n=!1;s.addEventListener(t,e=>{n||(n=!0,requestAnimationFrame(()=>{s.dispatchEvent(new CustomEvent(a,{detail:e})),n=!1}))})};function T(e){return e&&"object"==typeof e&&!Array.isArray(e)}function x(e,t){let a=Object.assign({},e);return T(e)&&T(t)&&Object.keys(t).forEach(s=>{T(t[s])&&s in e?a[s]=x(e[s],t[s]):Object.assign(a,{[s]:t[s]})}),a}L("resize","amst__optimizedResize"),L("scroll","amst__optimizedScroll");let k=t=>{return function(a){let s="string"==typeof a?t.querySelector(a):a;return s&&(s.css=t=>{if("string"==typeof t){let a=e.getComputedStyle(s,null).getPropertyValue(t);return isNaN(parseFloat(a))?a:parseFloat(a)}return Object.assign(s.style,t),s},s.setAttributes=e=>{Object.keys(e).forEach(t=>s.setAttribute(t,e[t]))},s.on=function(e,t,a=!1){return e.split(" ").forEach(e=>s.addEventListener(e,t,a)),s},s.off=function(e,t){return e.split(" ").forEach(e=>s.removeEventListener(e,t)),s}),s}},A=e=>{return t=>{let a=Array.isArray(t)?t:Array.from(e.querySelectorAll(t));return a.css=e=>{if("string"==typeof e){let t=window.getComputedStyle(a[0],null).getPropertyValue(e);return isNaN(parseFloat(t))?t:parseFloat(t)}return a.forEach(t=>{Object.assign(t.style,e)}),a},a.on=function(e,t,s=!1){return a.forEach(a=>{e.split(" ").forEach(e=>a.addEventListener(e,t,s))}),a},a.off=function(e,t){return a.forEach(a=>{e.split(" ").forEach(e=>a.removeEventListener(e,t))}),a},a.length?a:null}};export default y;
