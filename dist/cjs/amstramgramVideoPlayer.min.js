/*amstramgramVideoPlayer.js--@version:1.0.0--@licence:MIT--@url:https://github.com/Amstramgram75/Amstramgram-Video-Player*/
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var w=window,d=document,myPointerType=w.PointerEvent?"pointer":w.TouchEvent?"touch":"mouse",myPointerEnter="touch"==myPointerType?"none":myPointerType+"enter",myPointerLeave="touch"==myPointerType?"none":myPointerType+"leave",myPointerDown="touch"==myPointerType?"touchstart":myPointerType+"down",myPointerUp="touch"==myPointerType?"touchend":myPointerType+"up",myPointerMove=myPointerType+"move",UA=w.navigator.userAgent.toLowerCase(),IS_MOBILE=/ipad|iphone|ipod/i.test(UA)&&!w.MSStream||/android/i.test(UA);null==Element.prototype.getAttributeNames&&(Element.prototype.getAttributeNames=function(){for(var e=this.attributes,t=e.length,n=new Array(t),a=0;a<t;a++)n[a]=e[a].name;return n});var timeWidth,longTimeWidth,storage=function(){try{var e="__storage_test__";return w.sessionStorage.setItem(e,e),w.sessionStorage.removeItem(e),w.sessionStorage}catch(e){return!1}}();if(storage&&storage.getItem("amst_timeWidth"))timeWidth=storage.getItem("amst_timeWidth"),longTimeWidth=storage.getItem("amst_longTimeWidth");else{var measureTime=d.createElement("div"),measureLongTime=d.createElement("div");measureTime.classList.add("amst__measureTime"),measureTime.innerHTML="<span>00:00<span>",measureLongTime.classList.add("amst__measureTime"),measureLongTime.innerHTML="<span>00:00:00<span>",d.body.appendChild(measureTime),d.body.appendChild(measureLongTime),timeWidth=measureTime.offsetWidth+2,longTimeWidth=measureLongTime.offsetWidth+2,d.body.removeChild(measureTime),d.body.removeChild(measureLongTime),storage&&(storage.setItem("amst_timeWidth",timeWidth),storage.setItem("amst_longTimeWidth",longTimeWidth))}var style=d.createElement("style");style.appendChild(d.createTextNode("")),d.head.appendChild(style),style.sheet.insertRule(".amst__time>span{width:".concat(timeWidth,"px;"),0),style.sheet.insertRule(".amst__long .amst__time>span{width:".concat(longTimeWidth,"px;"),0);var transitionPrefix,transformPrefix,fullscreenAPI=!1;if(storage&&null!=storage.getItem("amst_fullscreenAPI")?fullscreenAPI=JSON.parse(storage.getItem("amst_fullscreenAPI")):(fullscreenAPI=function(){for(var e,t=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenchange"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitfullscreenchange"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitfullscreenchange"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozfullscreenchange"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","MSFullscreenChange"]],n=0,a=t.length,s={};n<a;n++)if((e=t[n])&&e[1]in d){for(n=0;n<e.length;n++)s[t[0][n]]=e[n];return s}return!1}(),storage.setItem("amst_fullscreenAPI",JSON.stringify(fullscreenAPI))),storage&&null!=storage.getItem("amst_transitionPrefix")&&null!=storage.getItem("amst_transformPrefix"))transitionPrefix=storage.getItem("amst_transitionPrefix"),transformPrefix=storage.getItem("amst_transformPrefix");else{var GetVendorPrefix=function(e){for(var t=d.createElement("div"),n="",a=0;a<e.length;++a){if(void 0!==t.style[e[a]]){n=e[a];break}n=null}return n};transitionPrefix=GetVendorPrefix(["transition","msTransition","MozTransition","WebkitTransition","OTransition"]),transformPrefix=GetVendorPrefix(["transform","msTransform","MozTransform","WebkitTransform","OTransform"]),storage.setItem("amst_transitionPrefix",transitionPrefix),storage.setItem("amst_transformPrefix",transformPrefix)}var _pointerType="unknown";if(storage&&storage.getItem("amst_pointerType"))_pointerType=storage.getItem("amst_pointerType");else{var testPointerMove=function(e){_pointerType=e.pointerType?e.pointerType:"mouse",cleanTestPointer()},testTouchStart=function(){_pointerType="touch",cleanTestPointer()},cleanTestPointer=function(){storage.setItem("amst_pointerType",_pointerType),w.removeEventListener(myPointerMove,testPointerMove),w.removeEventListener("touchstart",testTouchStart),AmstramgramVideoPlayer.players.length>0&&AmstramgramVideoPlayer.players.forEach((function(e){return e.container.dispatchEvent(new CustomEvent("pointerDetected"))}))};w.addEventListener(myPointerMove,testPointerMove,!1)}var _supportPassiveEvents=!1;storage&&storage.getItem("amst_supportPassiveEvents")?_supportPassiveEvents=storage.getItem("amst_supportPassiveEvents"):d.createElement("div").addEventListener("test",(function(){}),{get passive(){return _supportPassiveEvents=!0,storage.setItem("amst_supportPassiveEvents",_supportPassiveEvents),!1}});var AmstramgramVideoPlayer=function(){function e(t,n){var a=this;_classCallCheck(this,e);var s=["autoplay","loop","muted","playsinline"],r=s.concat(["crossorigin","poster","preload","src"]);this.params=t.getAttributeNames().reduce((function(e,n){return r.includes(n)&&(e[n]=!!s.includes(n)||t.getAttribute(n)),e}),{}),this.params.muted&&(this.params.volume=0,delete this.params.muted),parseInt(t.getAttribute("width"))>0&&parseInt(t.getAttribute("height"))>0&&(this.params.format=parseInt(t.getAttribute("width"))/parseInt(t.getAttribute("height"))),r=r.filter((function(e){return"muted"!=e})).concat(["download","duration","format","fullscreen","hideControlsDelay","next","onInit","previous","skipTime","thumbnails","videoVolumeOrientation","volume","volumeButton","volumeForced","volumeGroup","railMinWidthForNormalUI"]),n&&(n=Object.keys(n).filter((function(e){return r.includes(e)})).reduce((function(e,t){return e[t]=n[t],e}),{})),n&&(this.params=mergeDeep(this.params,n)),this.params=mergeDeep(e.defaultOptions,this.params);var o=d.createElement("div"),i="horizontal"==this.params.videoVolumeOrientation?"horizontal":"vertical",l=_supportPassiveEvents;o.classList.add("amst__wrapper"),o.classList.add("amst__video"),o.innerHTML=buildUI(this.params),t.parentNode.insertBefore(o,t),t.setAttribute("src",""),t.parentNode.removeChild(t);var u,m,c,p,v,f,_,h,y,b,g,P,T,E,L,x=this,k=_$(o),A=_$$(o),I=this.media=k("video"),C=this.container=k(".amst__container"),M=k(".amst__layer-poster"),O=k(".amst__layer-poster canvas"),B=k(".amst__layer-seeking-touch"),S=k(".amst__seeking-touch"),F=k(".amst__layer-play"),W=k(".amst__layer-loading"),z=k(".amst__controls"),D=2*z.css("padding-left"),N=k(".amst__playpause>button"),j=k(".amst__rail"),H=k(".amst__slider"),V=k(".amst__handle"),R=k(".amst__currenttime-bar"),U=k(".amst__seeking"),X=k(".amst__volumebutton button"),G=k(".amst__volume-slider"),q=0,$=0,Y=!1,J=!1,Q=!1,K=0;function Z(){var t=I.play();t&&t.catch((function(){setTimeout((function(){(t=I.play()).catch((function(){return ee()}))}),50)})),e.currentPlayer&&e.currentPlayer!=x&&e.currentPlayer.reset(),e.currentPlayer=x,C.focus(),N.setAttributes({class:"amst__pause",title:x.params.pauseLabel,"aria-label":x.params.pauseLabel}),F.classList.add("amst__hidden"),Y||te({detail:{delayed:!0}})}function ee(){I.pause(),N.setAttributes({class:"",title:x.params.playLabel,"aria-label":x.params.playLabel}),F.classList.remove("amst__hidden"),ne(),C.focus()}function te(e){var t=!!e&&e.detail.delayed,n=!!e&&e.detail.forced;I.paused&&!n||(t||J||Y?(b&&clearTimeout(b),b=setTimeout((function(){return te()}),x.params.hideControlsDelay)):(C.focus(),z.style[transformPrefix]="translateX(-50%) scaleY(0)",Q=!0))}function ne(){b&&clearTimeout(b),z.style[transformPrefix]="",Q=!1,I.paused||te({detail:{delayed:!0}})}function ae(){window.location=x.src.substring(0,x.src.lastIndexOf("/"))+"/index.php?file="+x.src.substring(x.src.lastIndexOf("/")+1)}function se(e,t){var n=e.toLowerCase(),a=k(".amst__".concat(n)),s=k(".amst__".concat(n," > button"));!0===x.params[e].disabled?s.setAttribute("disabled",""):s.removeAttribute("disabled"),!0===x.params[e].hidden?a.classList.add("amst__hidden"):a.classList.remove("amst__hidden"),"volumeButton"==e&&G&&(!0===x.params.volumeButton.disabled||!0===x.params.volumeButton.hidden?G.classList.add("amst__hidden"):G.classList.remove("amst__hidden")),s.setAttributes({title:t,"aria-label":t}),Le()}function re(){se("previous",x.params.previous.label)}function oe(){se("next",x.params.next.label)}function ie(){!1===x.params.download.disabled&&!1===x.params.download.hidden?k(".amst__download>button").on("click",ae,!1):k(".amst__download>button").off("click",ae),se("download",x.params.download.label)}function le(){E=x.params.fullscreen.label.enter,L=x.params.fullscreen.label.exit,se("fullscreen",e.currentFullScreenPlayer==x?L:E)}function ue(){se("volumeButton",0==x.volume?x.params.volumeButton.label.unmute:x.params.volumeButton.label.mute)}function me(t){var n=t.detail;n="object"===_typeof(n)?n:{src:n},isNaN(n.volume)||!0!==n.volumeForced&&storage.getItem("amst_volumegroup".concat(n.volumeGroup))?storage.getItem("amst_volumegroup".concat(n.volumeGroup))&&(x.params.volume=storage.getItem("amst_volumegroup".concat(n.volumeGroup))):(x.params.volume=n.volume,storage.setItem("amst_volumegroup".concat(n.volumeGroup),n.volume));var a=["autoplay","crossorigin","download","duration","format","fullscreen","loop","next","playsinline","poster","preload","previous","src","skipTime","thumbnails","volumeButton","volumeGroup"];if(n=a.reduce((function(e,t){return a.includes(t)&&null!=n[t]&&(e[t]=n[t]),e}),{}),I.getAttribute("src")){for(C.classList.add("amst_container_transition"),x.media.pause(),$=0,q=0,y=void 0;I.attributes.length>0;)I.removeAttribute(I.attributes[0].name);["autoplay","crossorigin","loop","playsinline","thumbnails"].forEach((function(t){return x.params[t]=e.defaultOptions[t]})),C.classList.remove("amst__thumbnails","amst__loadedmetadata"),K=0,g=void 0,U.removeAttribute("style"),P=void 0,S.removeAttribute("style"),x.params=mergeDeep(x.params,n)}if(x.params.thumbnails.src){var s=new Image,r=function e(t){if(s.removeEventListener("load",e),s.removeEventListener("error",e),"load"==t.type){C.classList.add("amst__thumbnails"),K=s.naturalWidth/x.params.thumbnails.number;var n={width:"".concat(s.naturalWidth/x.params.thumbnails.number,"px"),height:"".concat(s.naturalHeight,"px"),"background-image":'url("'.concat(x.params.thumbnails.src,'")')};U.css(n),S.css(n)}else x.params.thumbnails.src=void 0};s.addEventListener("error",r,!1),s.addEventListener("load",r,!1),s.src=x.params.thumbnails.src}var o={src:x.params.src,preload:IS_MOBILE?"none":x.params.preload};!0===x.params.playsinline&&(o.playsinline="",o["webkit-playsinline"]=""),!0===x.params.loop&&(o.loop=""),x.params.crossorigin&&(o.crossorigin=x.params.crossorigin),I.setAttributes(o),x.volume=IS_MOBILE&&x.params.volume>0?1:x.params.volume,T||(T=0==I.volume?.1:I.volume,IS_MOBILE&&(T=1)),C.style.paddingBottom=1/x.params.format*100+"%",x.params.poster&&(M.style.backgroundImage='url("'.concat(x.params.poster,'")'),M.classList.remove("amst__hidden")),k(".amst__duration").innerHTML=secondsToTimeCode(x.params.duration),k(".amst__currenttime").innerHTML=secondsToTimeCode(0,x.params.duration>3600),re(),oe(),ie(),ue(),fullscreenAPI&&le(),!0===x.params.autoplay&&Z()}this.events={next:[],previous:[]},C.on("amstEvent__play",Z,!1),C.on("amstEvent__pause",ee,!1),C.on("amstEvent__reset",(function(){O.width=I.videoWidth,O.height=I.videoHeight,O.getContext("2d").drawImage(I,0,0,O.width,O.height),M.classList.remove("amst__hidden"),C.classList.remove("amst__loadedmetadata"),I.src="",I.preload="none",I.src=x.params.src}),!1),C.on("amstEvent__hideControls",te,!1),C.on("amstEvent__showControls",ne,!1),k(".amst__next").on("click",(function(){var e=this;_toConsumableArray(x.events.next).forEach((function(t){return t.bind(e)}))})),k(".amst__previous").on("click",(function(){var e=this;_toConsumableArray(x.events.previous).forEach((function(t){return t.bind(e)}))})),k(".amst__next").on("click",(function(){var e=this;_toConsumableArray(x.events.next).forEach((function(t){return t.apply(e)}))})),k(".amst__previous").on("click",(function(){var e=this;_toConsumableArray(x.events.previous).forEach((function(t){return t.apply(e)}))})),C.on("amstEvent__previousButton",re,!1),C.on("amstEvent__nextButton",oe,!1),C.on("amstEvent__fullscreenButton",le,!1),C.on("amstEvent__downloadButton",ie,!1),C.on("amstEvent__volumeButton",ue,!1),C.on("amstEvent__src",me,!1),me({detail:this.params}),I.on("mousemove",(function(){return ne()}),!!l&&{passive:!0}).on("loadedmetadata",(function(){var t=a.params.format=I.videoWidth/I.videoHeight;e.currentFullScreenPlayer==x?w.dispatchEvent(new CustomEvent("optimizedResize")):C.style.paddingBottom=1/t*100+"%",C.classList.add("amst__loadedmetadata"),I.currentTime=q})).on("loadeddata",(function(){I.currentTime=q})).on("durationchange",(function(){a.params.duration=I.duration,h="string"==typeof a.params.skipTime&&"%"==a.params.skipTime.slice(-1)?parseFloat(a.params.skipTime)*I.duration/100:parseFloat(a.params.skipTime),I.duration>=3600?C.classList.add("amst__long"):C.classList.remove("amst__long"),H.setAttribute("aria-valuemax",I.duration),k(".amst__duration").innerHTML=secondsToTimeCode(I.duration),k(".amst__currenttime").innerHTML=secondsToTimeCode(q,I.duration>3600),Le()})).on("progress",ve).on("timeupdate",(function(){if(!isNaN(I.duration)){ve(),H.setAttribute("aria-valuenow",I.currentTime);var e=Math.floor(I.currentTime);if(q!=e){var t=secondsToTimeCode(q=e,I.duration>3600);k(".amst__currenttime").innerHTML=t,H.setAttribute("aria-valuetext",t)}(0==$||Math.abs(I.currentTime-$)>.5)&&(cancelAnimationFrame(_),_e()),$=I.currentTime}})).on("ended",(function(){I.currentTime=0,a.pause()})).on("pause",(function(){return cancelAnimationFrame(_)})).on("playing",(function(){$=0,M.classList.add("amst__hidden")})).on("seeked",(function(){0==q&&a.paused&&(O.width=0,O.height=0,M.classList.remove("amst__hidden"))})).on("play playing seeked canplay",(function(){J=!1,C.classList.remove("amst__buffering")})).on("seeking waiting loadeddata",(function(){J=!0,C.classList.add("amst__buffering")}));var ce=k(".amst__loaded-bar"),de=ce.offsetHeight,pe=ce.getContext("2d");function ve(){if(!function(e,t){if(!e||!t||e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e.start(n)!=t.start(n)||e.end(n)!=t.end(n))return n=e.length,!1;return!0}(I.buffered,y)){pe.clearRect(0,0,ce.width,ce.height);for(var e=ce.width/I.duration,t=0;t<I.buffered.length;t++){var n=I.buffered.start(t)*e,a=I.buffered.end(t)*e-n;new AmstRoundedRect(pe,de,n,a)}y=I.buffered}}ce.height=de,pe.fillStyle=ce.css("color");var fe=.5*V.offsetWidth;function _e(){var e,t,n,a,s=I.paused&&!I.seeking?"all .15s ease-in":"none",r=I.currentTime,o=I.duration,i=isNaN(o)?0:(r/o).toFixed(4),l=i*p-fe;(l=Math.max(l,0),l=Math.min(l,p-2*fe)+"px",I.paused)?(R.css((_defineProperty(e={},transitionPrefix,s),_defineProperty(e,transformPrefix,"scaleX(".concat(i,")")),e)),V.css((_defineProperty(t={},transitionPrefix,s),_defineProperty(t,transformPrefix,"translateX(".concat(l,")")),t))):(R.css((_defineProperty(n={},transitionPrefix,s),_defineProperty(n,transformPrefix,"scaleX(".concat(i,")")),n)),V.css((_defineProperty(a={},transitionPrefix,s),_defineProperty(a,transformPrefix,"translateX(".concat(l,")")),a)),_=requestAnimationFrame(_e))}function he(e){var t=((e.changedTouches?e.changedTouches[0].clientX:e.clientX)-c)/p;I.currentTime=t*I.duration}function ye(e){x.paused||Y||te({detail:{delayed:!0}}),he(e),j.off(myPointerMove,he),j.off(myPointerUp+" "+myPointerLeave,ye)}if(A([I,W,B,F]).on("touchstart",(function(e){var t=k(e.target),n=(new Date).getTime(),a=200,s=I.duration?I.currentTime/I.duration:void 0,r=e.changedTouches[0].pageX,o=e.changedTouches[0].pageY,i=0,m=0,c=0,d=void 0,p=!1;function v(e){if(I.duration&&!(x.paused&&c<-5))if(p)e.preventDefault();else{if(c>-5&&e.preventDefault(),i=e.changedTouches[0].pageX-r,m=e.changedTouches[0].pageY-o,Math.abs(i)>Math.abs(m)?c++:c--,c>=5){d=Math.min(Math.max(s+i/u,0),.999),P||(P=S.offsetWidth);var t=Math.min(Math.max(d*u-.5*P,0),u-P)+"px",n=_defineProperty({},transformPrefix,"translateX(".concat(t,")"));x.params.thumbnails.src&&(n.backgroundPosition=-Math.floor(100*d)*K+"px 0"),S.css(n),k(".amst__seeking-touch-cache").style[transformPrefix]="scaleX(".concat(d,")"),k(".amst__seeking-touch > span").innerHTML=secondsToTimeCode(I.duration*d,I.duration>3600),5==c&&(B.classList.add("amst__show"),te({detail:{delayed:!1,forced:!0}}))}-5==c&&(m<0?Q&&(ne(),p=!0):Q||(te(),p=!0))}}t.on("touchend",(function e(s){null!=d?(I.currentTime=I.duration*d,B.classList.remove("amst__show"),ne()):p||a>(new Date).getTime()-n&&x.togglePlayPause();t.off("touchend",e);t.off("touchmove",v)}),!!l&&{passive:!0}),t.on("touchmove",v,!!l&&{passive:!1})}),!!l&&{passive:!1}),A([I,W]).on("click",(function(){return a.pause()}),!1),C.on("touchstart mousedown",(function(){C.classList.remove("amst__keyboard-active")}),!!l&&{passive:!0}),k(".amst__playpause").on("click",(function(){return a.togglePlayPause()})),F.on("click",(function(){return a.play()})),z.on(myPointerEnter,(function(e){if("touch"==myPointerType||e.pointerType&&"touch"==e.pointerType)return!1;ne(),Y=!0})).on(myPointerLeave,(function(e){if("touch"==myPointerType||e.pointerType&&"touch"==e.pointerType)return!1;Y=!1,te({detail:{delayed:!0}})})),j.on(myPointerDown,(function(){if(isNaN(I.duration))return!1;j.on(myPointerMove,he,!!l&&{passive:!0}),j.on(myPointerUp+" "+myPointerLeave,ye,!1)}),!!l&&{passive:!0}),throttle(myPointerMove,"optimizedPointerMove",H),H.on("optimizedPointerMove",(function(e){if("touch"==myPointerType||e.pointerType&&"touch"==e.pointerType||isNaN(I.duration))return!1;g||(g=U.offsetWidth);var t=e.detail.clientX-c,n=t/p,a=-Math.floor(100*n)*K+"px",s=.5*g-6;x.params.thumbnails.src&&(U.style.backgroundPosition=a+" 0"),k(".amst__cursor").style[transformPrefix]="translateX(".concat(t,"px)"),t=Math.max(t,s),t=Math.min(t,p-s),k(".amst__seeking-wrapper").style[transformPrefix]="translateX(".concat(t,"px)"),k(".amst__seeking > span").innerHTML=secondsToTimeCode(n*I.duration,I.duration>3600)})),I.on("volumechange",(function(){if(!IS_MOBILE){var t=parseInt(100*I.volume);G.setAttributes({"aria-valuenow":t,"aria-valuetext":t+"%"}),"horizontal"==i?k(".amst__volume-current").style.width=t+"%":k(".amst__volume-handle").style.bottom=t+"%"}0==I.volume?(I.muted=!0,X.setAttributes({title:x.params.volumeButton.label.unmute,"aria-label":x.params.volumeButton.label.unmute,class:"amst__unmute"})):(I.muted=!1,T=I.volume,X.classList.contains("amst__unmute")&&(X.removeAttribute("class"),X.setAttributes({title:x.params.volumeButton.label.mute,"aria-label":x.params.volumeButton.label.mute}))),storage&&x.params.volumeGroup>-1&&storage.setItem("amst_volumegroup".concat(x.params.volumeGroup),x.volume),x.params.volume=x.volume,x.params.volumeGroup>-1&&e.players.length>1&&e.players.forEach((function(e){e!=x&&e.params.volumeGroup==x.params.volumeGroup&&e.volume!=x.volume&&(e.volume=x.volume)}))})),X.on("click",(function(){I.muted?(I.volume=T,I.muted=!1):(I.volume=0,I.muted=!0)})),!IS_MOBILE){G.on(myPointerDown,(function(){G.on(myPointerMove,be).on(myPointerLeave,ge).on(myPointerUp,be).on(myPointerUp,ge)}));var be=function(e){var t;"horizontal"==i?(t=Math.max(0,e.clientX-m.left),t=(t/=m.width)>.96?1:t):(G.style.cursor="ns-resize",t=m.height-e.clientY+m.top,t=Math.max(0,Math.min(t,100))/100),x.volume=t},ge=function e(){G.off(myPointerMove,be).off(myPointerLeave,e).off(myPointerUp,be).off(myPointerUp,e),"vertical"==i&&(G.style.cursor="")};C.on("keydown",(function(e){switch(C.classList.add("amst__keyboard-active"),ne(),[37,38,39,40,77].includes(e.which)&&e.preventDefault(),e.which>36&&e.which<41&&(38!=e.which&&40!=e.which||d.activeElement==G||("vertical"==i?(G.on("transitionend",(function e(){this.removeEventListener("transitionend",e),this.focus()})),X.focus()):G.focus()),37!=e.which&&39!=e.which||d.activeElement==H||H.focus()),e.which){case 77:!0!==x.params.volumeButton.disabled&&!0!==x.params.volumeButton.hidden&&(X.dispatchEvent(new MouseEvent("click")),X.focus());break;case 40:!0!==x.params.volumeButton.disabled&&!0!==x.params.volumeButton.hidden&&(x.volume=Math.max(0,x.volume-.05));break;case 38:!0!==x.params.volumeButton.disabled&&!0!==x.params.volumeButton.hidden&&(x.volume=Math.min(1,x.volume+.05));break;case 37:x.currentTime=Math.max(0,x.currentTime-h);break;case 39:x.currentTime=Math.min(x.duration,x.currentTime+h);break;case 32:if(d.activeElement==N)return;"BUTTON"!=d.activeElement.nodeName&&(e.preventDefault(),x.togglePlayPause())}}),!1)}if(fullscreenAPI){var Pe=0,Te=0,Ee=k(".amst__fullscreen>button");Ee.on("click",(function(){null!==d[fullscreenAPI.fullscreenElement]?d[fullscreenAPI.exitFullscreen]():(Pe=w.pageXOffset,Te=w.pageYOffset,o[fullscreenAPI.requestFullscreen](),e.currentFullScreenPlayer=x)})),d.addEventListener(fullscreenAPI.fullscreenchange,(function(){d[fullscreenAPI.fullscreenElement]==o?(w.addEventListener("optimizedResize",we),o.classList.add("amst__isfullscreen"),C.classList.add("amst__notransition"),Ee.setAttributes({title:L,"aria-label":L,class:" amst__unfullscreen"}),we()):e.currentFullScreenPlayer==x&&(w.removeEventListener("optimizedResize",we),C.setAttribute("style","padding-bottom:".concat(1/x.params.format*100,"%")),o.classList.remove("amst__isfullscreen"),Ee.setAttributes({title:E,"aria-label":E,class:""}),setTimeout((function(){w.scroll(Pe,Te),setTimeout((function(){C.classList.remove("amst__notransition")}),50)}),50),e.currentFullScreenPlayer=void 0)}),!1);var we=function(){w.innerWidth/w.innerHeight>x.params.format?C.css({width:w.innerHeight*x.params.format+"px",height:"100%",paddingBottom:0}):C.css({width:"100%",height:"auto",paddingBottom:1/x.params.format*100+"%"}),xe()}}function Le(){f&&clearTimeout(f),f=setTimeout((function(){v=0,A(".amst__controls>div:not(.amst__rail):not(.amst__hidden):not(.amst__time-duration)").forEach((function(e){e.classList.contains("amst__time")?v+=2*e.offsetWidth:v+=e.offsetWidth})),xe()}),1)}function xe(){(u=C.offsetWidth)-D-v<e.defaultOptions.railMinWidthForNormalUI?C.classList.add("amst__compact"):C.classList.remove("amst__compact");var t=H.getBoundingClientRect();if(c=t.left,p=t.width,_e(),!IS_MOBILE){var n=function e(t){m=k(".amst__volume-total").getBoundingClientRect(),t&&t.target==C&&C.off("transitionend",e)};C.on("transitionend",n,!1),n()}}w.addEventListener("optimizedResize",xe),w.addEventListener("optimizedScroll",xe),"unknown"==_pointerType?C.addEventListener("pointerDetected",(function e(){C.removeEventListener("pointerDetected",e),"touch"!=_pointerType&&C.classList.add("amst__no-touch")}),!1):"touch"!=_pointerType&&C.classList.add("amst__no-touch"),e.players.push(this),n&&"function"==typeof n.onInit&&setTimeout((function(){n.onInit.call(x)}),0)}return _createClass(e,null,[{key:"options",value:function(t){0==e.players.length&&(e.defaultOptions=mergeDeep(e.defaultOptions,t))}}]),_createClass(e,[{key:"pause",value:function(){this.container.dispatchEvent(new CustomEvent("amstEvent__pause"))}},{key:"play",value:function(){this.container.dispatchEvent(new CustomEvent("amstEvent__play"))}},{key:"reset",value:function(){this.pause(),this.container.dispatchEvent(new CustomEvent("amstEvent__reset"))}},{key:"togglePlayPause",value:function(){this.paused?this.play():this.pause()}},{key:"hideControls",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.container.dispatchEvent(new CustomEvent("amstEvent__hideControls",{detail:{delayed:e,forced:t}}))}},{key:"showControls",value:function(){this.container.dispatchEvent(new CustomEvent("amstEvent__showControls"))}},{key:"previous",value:function(e){isObject(e)&&(this.params=mergeDeep(this.params,{previous:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__previousButton")))}},{key:"next",value:function(e){isObject(e)&&(this.params=mergeDeep(this.params.next,{next:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__nextButton")))}},{key:"fullscreen",value:function(e){isObject(e)&&(this.params=mergeDeep(this.params,{fullscreen:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__fullscreenButton")))}},{key:"download",value:function(e){isObject(e)&&(this.params=mergeDeep(this.params,{download:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__downloadButton")))}},{key:"volumeButton",value:function(e){isObject(e)&&(this.params=mergeDeep(this.params,{volumeButton:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__volumeButton")))}},{key:"on",value:function(e,t){"next"!=e&&"previous"!=e||this.events[e].push(t)}},{key:"off",value:function(e,t){if("next"==e||"previous"==e){var n=this.events[e].indexOf(t);n>-1&&this.events[e].splice(n,1)}}},{key:"src",set:function(e){this.container.dispatchEvent(new CustomEvent("amstEvent__src",{detail:e}))},get:function(){return this.media.getAttribute("src")}},{key:"paused",get:function(){return this.media.paused}},{key:"duration",get:function(){return this.media.duration}},{key:"currentTime",set:function(e){this.media.duration&&e>=0&&e<=this.media.duration&&(this.media.currentTime=e)},get:function(){return this.media.currentTime}},{key:"volume",set:function(e){this.media.volume=e},get:function(){return this.media.volume}}]),e}();function buildUI(e){var t="",n="";IS_MOBILE||(n='\n      <div class="amst__volume-slider" aria-label="'.concat(e.volumeSliderLabel,'" aria-valuemin="0" aria-valuemax="100" aria-valuenow="100" aria-valuetext="100%" role="slider" aria-orientation="').concat(e.videoVolumeOrientation,'" tabindex="0" title="').concat(e.volumeHelpLabel,'">\n        <span class="amst__offscreen">').concat(e.volumeHelpLabel,'</span>\n        <div class="amst__volume-total">\n          <div class="amst__volume-current" style="height: 100%;"></div>'),"horizontal"!=e.videoVolumeOrientation&&(n+='<div class="amst__volume-handle" style="bottom: 100%; margin-bottom: -3px;"></div>'),n+="</div></div>"),t='\n    <div class="amst__button amst__volumebutton">\n      <button type="button" tabindex="0"></button>',"horizontal"!=e.videoVolumeOrientation?t+=n+"</div>":t+="</div>"+n;var a='\n    <span class="amst__offscreen">'.concat(e.appLabel,'</span>\n    <div class="amst__container" tabindex="0" role="application" aria-label="').concat(e.appLabel,'">\n      <div class="amst__mediaelement">\n        <video></video>\n      </div>\n    <div class="amst__layers">\n      <div class="amst__layer-poster">\n        <canvas></canvas>\n      </div>\n      <div class="amst__layer-loading">\n        <div class="amst__loading">\n          <span class="amst__svg"></span>\n        </div>\n      </div>\n      <div class="amst__layer-play">\n        <div class="amst__svg" role="button" tabindex="0" aria-label="').concat(e.playLabel,'" aria-pressed="false"></div>\n      </div>\n      <div class="amst__layer-seeking-touch">\n        <div class="amst__seeking-touch-cache"></div>\n        <span class="amst__time amst__seeking-touch">\n          <span></span>\n        </span>\n      </div>\n    </div>\n    <div class="amst__controls">\n      <div class="amst__button amst__previous">\n        <button type="button" title="').concat(e.previous.label,'" aria-label="').concat(e.previous.label,'" tabindex="0"></button>\n      </div>\n      <div class="amst__button amst__playpause">\n        <button type="button" title="').concat(e.playLabel,'" aria-label="').concat(e.playLabel,'" tabindex="0"></button>\n      </div>\n      <div class="amst__button amst__next">\n        <button type="button" title="').concat(e.next.label,'" aria-label="').concat(e.next.label,'" tabindex="0"></button>\n      </div>\n      <div class="amst__time" role="timer" aria-live="off">\n        <span class="amst__currenttime">00:00</span>\n      </div>\n      <div class="amst__rail">\n        <span class="amst__slider" role="slider" tabindex="0">\n          <span class="amst__buffering-bar"></span>\n          <canvas class="amst__loaded-bar"></canvas>\n          <span class="amst__currenttime-bar"></span>\n          <span class="amst__handle"><span></span></span>\n          <span class="amst__cursor"><span></span></span>\n          <span class="amst__seeking-wrapper">\n            <span class="amst__time amst__seeking">\n              <span>00:00</span>\n            </span>\n          </span>\n        </span>\n      </div>\n      <div class="amst__time amst__time-duration">\n        <span class="amst__duration">00:00</span>\n      </div>');return a+=t,fullscreenAPI&&(a+='        \n      <div class="amst__button amst__fullscreen">\n        <button type="button" title="'.concat(e.fullscreen.label,'" aria-label="').concat(e.fullscreen.label,'" tabindex="0"></button>\n      </div>')),a+='\n      <div class="amst__button amst__download">\n        <button type="button" title="'.concat(e.download.label,'" aria-label="').concat(e.download.label,'" tabindex="0"></button>\n      </div>\n    </div>\n  ')}function secondsToTimeCode(e,t){e=Math.round(e);var n=Math.floor(e/3600),a=Math.floor((e-3600*n)/60),s=Math.round(e%60);return(n=n>9?n+":":n>0?"0"+n+":":t?"00:":"")+(a=a>9?a:"0"+a)+":"+(s=s>9?s:"0"+s)}AmstramgramVideoPlayer.currentPlayer=void 0,AmstramgramVideoPlayer.players=[],AmstramgramVideoPlayer.defaultOptions={autoplay:!1,crossorigin:"anonymous",download:{label:"Télécharger",disabled:!1,hidden:!1},duration:120,format:16/9,fullscreen:{label:{enter:"Plein écran",exit:"Quitter le plein écran"},disabled:!1,hidden:!1},loop:!1,next:{label:"Suivant",disabled:!0,hidden:!0},playsinline:!0,poster:void 0,preload:"none",previous:{label:"Précédent",disabled:!0,hidden:!0},skipTime:"1%",thumbnails:{src:void 0,number:100},volume:.8,volumeButton:{label:{mute:"Désactiver le son",unmute:"Activer le son"},disabled:!1,hidden:!1},volumeGroup:0,hideControlsDelay:5e3,videoVolumeOrientation:"vertical",railMinWidthForNormalUI:600,appLabel:"Lecteur Vidéo",pauseLabel:"Pause",playLabel:"Lecture",volumeHelpLabel:"Utilisez les flèches Haut/Bas du clavier pour augmenter ou diminuer le volume.",volumeSliderLabel:"Potentiomètre de volume"};var AmstRoundedRect=function e(t,n,a,s){_classCallCheck(this,e);t.beginPath(),t.moveTo(a+2,0),t.lineTo(a+s-2,0),t.quadraticCurveTo(a+s,0,a+s,2),t.lineTo(a+s,0+n-2),t.quadraticCurveTo(a+s,0+n,a+s-2,0+n),t.lineTo(a+2,0+n),t.quadraticCurveTo(a,0+n,a,0+n-2),t.lineTo(a,2),t.quadraticCurveTo(a,0,a+2,0),t.closePath(),t.fill()},throttle=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w,a=!1,s=function(e){a||(a=!0,requestAnimationFrame((function(){n.dispatchEvent(new CustomEvent(t,{detail:e})),a=!1})))};n.addEventListener(e,s)};function isObject(e){return e&&"object"===_typeof(e)&&!Array.isArray(e)}function mergeDeep(e,t){var n=Object.assign({},e);return isObject(e)&&isObject(t)&&Object.keys(t).forEach((function(a){isObject(t[a])&&a in e?n[a]=mergeDeep(e[a],t[a]):Object.assign(n,_defineProperty({},a,t[a]))})),n}throttle("resize","optimizedResize"),throttle("scroll","optimizedScroll");var _$=function(e){return function(t){var n="string"==typeof t?e.querySelector(t):t;return n&&(n.css=function(e){if("string"==typeof e){var t=w.getComputedStyle(n,null).getPropertyValue(e);return isNaN(parseFloat(t))?t:parseFloat(t)}return Object.assign(n.style,e),n},n.setAttributes=function(e){Object.keys(e).forEach((function(t){return n.setAttribute(t,e[t])}))},n.on=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.split(" ").forEach((function(e){return n.addEventListener(e,t,a)})),n},n.off=function(e,t){return e.split(" ").forEach((function(e){return n.removeEventListener(e,t)})),n}),n}},_$$=function(e){return function(t){var n=Array.isArray(t)?t:Array.from(e.querySelectorAll(t));return n.css=function(e){if("string"==typeof e){var t=window.getComputedStyle(n[0],null).getPropertyValue(e);return isNaN(parseFloat(t))?t:parseFloat(t)}return n.forEach((function(t){Object.assign(t.style,e)})),n},n.on=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n.forEach((function(n){e.split(" ").forEach((function(e){return n.addEventListener(e,t,a)}))})),n},n.off=function(e,t){return n.forEach((function(n){e.split(" ").forEach((function(e){return n.removeEventListener(e,t)}))})),n},n.length?n:null}};module.exports=AmstramgramVideoPlayer;
