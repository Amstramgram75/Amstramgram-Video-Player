/*amstramgramVideoPlayer.js--@version:1.0.0--@licence:MIT--@url:https://github.com/Amstramgram75/Amstramgram-Video-Player*/
"use strict";const w=window,d=document,myPointerType=w.PointerEvent?"pointer":w.TouchEvent?"touch":"mouse",myPointerEnter="touch"==myPointerType?"none":myPointerType+"enter",myPointerLeave="touch"==myPointerType?"none":myPointerType+"leave",myPointerDown="touch"==myPointerType?"touchstart":myPointerType+"down",myPointerUp="touch"==myPointerType?"touchend":myPointerType+"up",myPointerMove=myPointerType+"move",UA=w.navigator.userAgent.toLowerCase(),IS_MOBILE=/ipad|iphone|ipod/i.test(UA)&&!w.MSStream||/android/i.test(UA);null==Element.prototype.getAttributeNames&&(Element.prototype.getAttributeNames=function(){for(var e=this.attributes,t=e.length,a=new Array(t),s=0;s<t;s++)a[s]=e[s].name;return a});const storage=function(){try{let e="__storage_test__";return w.sessionStorage.setItem(e,e),w.sessionStorage.removeItem(e),w.sessionStorage}catch(e){return!1}}();let timeWidth,longTimeWidth;if(storage&&storage.getItem("amst_timeWidth"))timeWidth=storage.getItem("amst_timeWidth"),longTimeWidth=storage.getItem("amst_longTimeWidth");else{const e=d.createElement("div"),t=d.createElement("div");e.classList.add("amst__measureTime"),e.innerHTML="<span>00:00<span>",t.classList.add("amst__measureTime"),t.innerHTML="<span>00:00:00<span>",d.body.appendChild(e),d.body.appendChild(t),timeWidth=e.offsetWidth+2,longTimeWidth=t.offsetWidth+2,d.body.removeChild(e),d.body.removeChild(t),storage&&(storage.setItem("amst_timeWidth",timeWidth),storage.setItem("amst_longTimeWidth",longTimeWidth))}const style=d.createElement("style");style.appendChild(d.createTextNode("")),d.head.appendChild(style),style.sheet.insertRule(`.amst__time>span{width:${timeWidth}px;`,0),style.sheet.insertRule(`.amst__long .amst__time>span{width:${longTimeWidth}px;`,0);let transitionPrefix,transformPrefix,fullscreenAPI=!1;if(storage&&null!=storage.getItem("amst_fullscreenAPI")?fullscreenAPI=JSON.parse(storage.getItem("amst_fullscreenAPI")):(fullscreenAPI=function(){let e,t=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenchange"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitfullscreenchange"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitfullscreenchange"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozfullscreenchange"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","MSFullscreenChange"]],a=0,s=t.length,n={};for(;a<s;a++)if((e=t[a])&&e[1]in d){for(a=0;a<e.length;a++)n[t[0][a]]=e[a];return n}return!1}(),storage.setItem("amst_fullscreenAPI",JSON.stringify(fullscreenAPI))),storage&&null!=storage.getItem("amst_transitionPrefix")&&null!=storage.getItem("amst_transformPrefix"))transitionPrefix=storage.getItem("amst_transitionPrefix"),transformPrefix=storage.getItem("amst_transformPrefix");else{let e=function(e){let t=d.createElement("div"),a="";for(let s=0;s<e.length;++s){if(void 0!==t.style[e[s]]){a=e[s];break}a=null}return a};transitionPrefix=e(["transition","msTransition","MozTransition","WebkitTransition","OTransition"]),transformPrefix=e(["transform","msTransform","MozTransform","WebkitTransform","OTransform"]),storage.setItem("amst_transitionPrefix",transitionPrefix),storage.setItem("amst_transformPrefix",transformPrefix)}let _pointerType="unknown";if(storage&&storage.getItem("amst_pointerType"))_pointerType=storage.getItem("amst_pointerType");else{const e=function(e){_pointerType=e.pointerType?e.pointerType:"mouse",a()},t=function(){_pointerType="touch",a()},a=function(){storage.setItem("amst_pointerType",_pointerType),w.removeEventListener(myPointerMove,e),w.removeEventListener("touchstart",t),AmstramgramVideoPlayer.players.length>0&&AmstramgramVideoPlayer.players.forEach(e=>e.container.dispatchEvent(new CustomEvent("pointerDetected")))};w.addEventListener(myPointerMove,e,!1)}let _supportPassiveEvents=!1;storage&&storage.getItem("amst_supportPassiveEvents")?_supportPassiveEvents=storage.getItem("amst_supportPassiveEvents"):d.createElement("div").addEventListener("test",()=>{},{get passive(){return _supportPassiveEvents=!0,storage.setItem("amst_supportPassiveEvents",_supportPassiveEvents),!1}});class AmstramgramVideoPlayer{static options(e){0==AmstramgramVideoPlayer.players.length&&(AmstramgramVideoPlayer.defaultOptions=mergeDeep(AmstramgramVideoPlayer.defaultOptions,e))}constructor(e,t){const a=["autoplay","loop","muted","playsinline"];let s=a.concat(["crossorigin","poster","preload","src"]);this.params=e.getAttributeNames().reduce((t,n)=>(s.includes(n)&&(t[n]=!!a.includes(n)||e.getAttribute(n)),t),{}),this.params.muted&&(this.params.volume=0,delete this.params.muted),parseInt(e.getAttribute("width"))>0&&parseInt(e.getAttribute("height"))>0&&(this.params.format=parseInt(e.getAttribute("width"))/parseInt(e.getAttribute("height"))),s=s.filter(e=>"muted"!=e).concat(["download","duration","format","fullscreen","hideControlsDelay","next","onInit","previous","skipTime","thumbnails","videoVolumeOrientation","volume","volumeButton","volumeForced","volumeGroup","railMinWidthForNormalUI"]),t&&(t=Object.keys(t).filter(e=>s.includes(e)).reduce((e,a)=>(e[a]=t[a],e),{})),t&&(this.params=mergeDeep(this.params,t)),this.params=mergeDeep(AmstramgramVideoPlayer.defaultOptions,this.params);const n=d.createElement("div"),r="horizontal"==this.params.videoVolumeOrientation?"horizontal":"vertical",i=_supportPassiveEvents;n.classList.add("amst__wrapper"),n.classList.add("amst__video"),n.innerHTML=buildUI(this.params),e.parentNode.insertBefore(n,e),e.setAttribute("src",""),e.parentNode.removeChild(e);const o=this,l=_$(n),m=_$$(n),u=this.media=l("video"),c=this.container=l(".amst__container"),p=l(".amst__layer-poster"),v=l(".amst__layer-poster canvas"),h=l(".amst__layer-seeking-touch"),_=l(".amst__seeking-touch"),f=l(".amst__layer-play"),g=l(".amst__layer-loading"),y=l(".amst__controls"),b=2*y.css("padding-left"),P=l(".amst__playpause>button"),T=l(".amst__rail"),E=l(".amst__slider"),L=l(".amst__handle"),x=l(".amst__currenttime-bar"),A=l(".amst__seeking"),I=l(".amst__volumebutton button"),k=l(".amst__volume-slider");let M,C,B,O,$,F,S,V,W,z,D,N,H,j,R,U=0,X=0,q=!1,G=!1,Y=!1,J=0;function Q(){let e=u.play();e&&e.catch(()=>{setTimeout(()=>{(e=u.play()).catch(()=>K())},50)}),AmstramgramVideoPlayer.currentPlayer&&AmstramgramVideoPlayer.currentPlayer!=o&&AmstramgramVideoPlayer.currentPlayer.reset(),AmstramgramVideoPlayer.currentPlayer=o,c.focus(),P.setAttributes({class:"amst__pause",title:o.params.pauseLabel,"aria-label":o.params.pauseLabel}),f.classList.add("amst__hidden"),q||Z({detail:{delayed:!0}})}function K(){u.pause(),P.setAttributes({class:"",title:o.params.playLabel,"aria-label":o.params.playLabel}),f.classList.remove("amst__hidden"),ee(),c.focus()}function Z(e){let t=!!e&&e.detail.delayed,a=!!e&&e.detail.forced;u.paused&&!a||(t||G||q?(z&&clearTimeout(z),z=setTimeout(()=>Z(),o.params.hideControlsDelay)):(c.focus(),y.style[transformPrefix]="translateX(-50%) scaleY(0)",Y=!0))}function ee(){z&&clearTimeout(z),y.style[transformPrefix]="",Y=!1,u.paused||Z({detail:{delayed:!0}})}function te(){window.location=o.src.substring(0,o.src.lastIndexOf("/"))+"/index.php?file="+o.src.substring(o.src.lastIndexOf("/")+1)}function ae(e,t){const a=e.toLowerCase(),s=l(`.amst__${a}`),n=l(`.amst__${a} > button`);!0===o.params[e].disabled?n.setAttribute("disabled",""):n.removeAttribute("disabled"),!0===o.params[e].hidden?s.classList.add("amst__hidden"):s.classList.remove("amst__hidden"),"volumeButton"==e&&k&&(!0===o.params.volumeButton.disabled||!0===o.params.volumeButton.hidden?k.classList.add("amst__hidden"):k.classList.remove("amst__hidden")),n.setAttributes({title:t,"aria-label":t}),fe()}function se(){ae("previous",o.params.previous.label)}function ne(){ae("next",o.params.next.label)}function re(){!1===o.params.download.disabled&&!1===o.params.download.hidden?l(".amst__download>button").on("click",te,!1):l(".amst__download>button").off("click",te),ae("download",o.params.download.label)}function ie(){j=o.params.fullscreen.label.enter,R=o.params.fullscreen.label.exit,ae("fullscreen",AmstramgramVideoPlayer.currentFullScreenPlayer==o?R:j)}function oe(){ae("volumeButton",0==o.volume?o.params.volumeButton.label.unmute:o.params.volumeButton.label.mute)}function le(e){let t=e.detail;t="object"==typeof t?t:{src:t},isNaN(t.volume)||!0!==t.volumeForced&&storage.getItem(`amst_volumegroup${t.volumeGroup}`)?storage.getItem(`amst_volumegroup${t.volumeGroup}`)&&(o.params.volume=storage.getItem(`amst_volumegroup${t.volumeGroup}`)):(o.params.volume=t.volume,storage.setItem(`amst_volumegroup${t.volumeGroup}`,t.volume));const a=["autoplay","crossorigin","download","duration","format","fullscreen","loop","next","playsinline","poster","preload","previous","src","skipTime","thumbnails","volumeButton","volumeGroup"];if(t=a.reduce((e,s)=>(a.includes(s)&&null!=t[s]&&(e[s]=t[s]),e),{}),u.getAttribute("src")){for(c.classList.add("amst_container_transition"),o.media.pause(),X=0,U=0,W=void 0;u.attributes.length>0;)u.removeAttribute(u.attributes[0].name);["autoplay","crossorigin","loop","playsinline","thumbnails"].forEach(e=>o.params[e]=AmstramgramVideoPlayer.defaultOptions[e]),c.classList.remove("amst__thumbnails","amst__loadedmetadata"),J=0,D=void 0,A.removeAttribute("style"),N=void 0,_.removeAttribute("style"),o.params=mergeDeep(o.params,t)}if(o.params.thumbnails.src){let e=new Image;const t=function(a){if(e.removeEventListener("load",t),e.removeEventListener("error",t),"load"==a.type){c.classList.add("amst__thumbnails"),J=e.naturalWidth/o.params.thumbnails.number;let t={width:`${e.naturalWidth/o.params.thumbnails.number}px`,height:`${e.naturalHeight}px`,"background-image":`url("${o.params.thumbnails.src}")`};A.css(t),_.css(t)}else o.params.thumbnails.src=void 0};e.addEventListener("error",t,!1),e.addEventListener("load",t,!1),e.src=o.params.thumbnails.src}let s={src:o.params.src,preload:IS_MOBILE?"none":o.params.preload};!0===o.params.playsinline&&(s.playsinline="",s["webkit-playsinline"]=""),!0===o.params.loop&&(s.loop=""),o.params.crossorigin&&(s.crossorigin=o.params.crossorigin),u.setAttributes(s),o.volume=IS_MOBILE&&o.params.volume>0?1:o.params.volume,H||(H=0==u.volume?.1:u.volume,IS_MOBILE&&(H=1)),c.style.paddingBottom=1/o.params.format*100+"%",o.params.poster&&(p.style.backgroundImage=`url("${o.params.poster}")`,p.classList.remove("amst__hidden")),l(".amst__duration").innerHTML=secondsToTimeCode(o.params.duration),l(".amst__currenttime").innerHTML=secondsToTimeCode(0,o.params.duration>3600),se(),ne(),re(),oe(),fullscreenAPI&&ie(),!0===o.params.autoplay&&Q()}this.events={next:[],previous:[]},c.on("amstEvent__play",Q,!1),c.on("amstEvent__pause",K,!1),c.on("amstEvent__reset",(function(){v.width=u.videoWidth,v.height=u.videoHeight,v.getContext("2d").drawImage(u,0,0,v.width,v.height),p.classList.remove("amst__hidden"),c.classList.remove("amst__loadedmetadata"),u.src="",u.preload="none",u.src=o.params.src}),!1),c.on("amstEvent__hideControls",Z,!1),c.on("amstEvent__showControls",ee,!1),l(".amst__next").on("click",(function(){[...o.events.next].forEach(e=>e.bind(this))})),l(".amst__previous").on("click",(function(){[...o.events.previous].forEach(e=>e.bind(this))})),l(".amst__next").on("click",(function(){[...o.events.next].forEach(e=>e.apply(this))})),l(".amst__previous").on("click",(function(){[...o.events.previous].forEach(e=>e.apply(this))})),c.on("amstEvent__previousButton",se,!1),c.on("amstEvent__nextButton",ne,!1),c.on("amstEvent__fullscreenButton",ie,!1),c.on("amstEvent__downloadButton",re,!1),c.on("amstEvent__volumeButton",oe,!1),c.on("amstEvent__src",le,!1),le({detail:this.params}),u.on("mousemove",()=>ee(),!!i&&{passive:!0}).on("loadedmetadata",()=>{let e=this.params.format=u.videoWidth/u.videoHeight;AmstramgramVideoPlayer.currentFullScreenPlayer==o?w.dispatchEvent(new CustomEvent("optimizedResize")):c.style.paddingBottom=1/e*100+"%",c.classList.add("amst__loadedmetadata"),u.currentTime=U}).on("loadeddata",()=>{u.currentTime=U}).on("durationchange",()=>{this.params.duration=u.duration,V="string"==typeof this.params.skipTime&&"%"==this.params.skipTime.slice(-1)?parseFloat(this.params.skipTime)*u.duration/100:parseFloat(this.params.skipTime),u.duration>=3600?c.classList.add("amst__long"):c.classList.remove("amst__long"),E.setAttribute("aria-valuemax",u.duration),l(".amst__duration").innerHTML=secondsToTimeCode(u.duration),l(".amst__currenttime").innerHTML=secondsToTimeCode(U,u.duration>3600),fe()}).on("progress",ce).on("timeupdate",()=>{if(isNaN(u.duration))return;ce(),E.setAttribute("aria-valuenow",u.currentTime);let e=Math.floor(u.currentTime);if(U!=e){let t=secondsToTimeCode(U=e,u.duration>3600);l(".amst__currenttime").innerHTML=t,E.setAttribute("aria-valuetext",t)}(0==X||Math.abs(u.currentTime-X)>.5)&&(cancelAnimationFrame(S),ve()),X=u.currentTime}).on("ended",()=>{u.currentTime=0,this.pause()}).on("pause",()=>cancelAnimationFrame(S)).on("playing",()=>{X=0,p.classList.add("amst__hidden")}).on("seeked",()=>{0==U&&this.paused&&(v.width=0,v.height=0,p.classList.remove("amst__hidden"))}).on("play playing seeked canplay",()=>{G=!1,c.classList.remove("amst__buffering")}).on("seeking waiting loadeddata",()=>{G=!0,c.classList.add("amst__buffering")});const me=l(".amst__loaded-bar"),ue=me.offsetHeight;let de=me.getContext("2d");function ce(){if(!function(e,t){if(!e||!t||e.length!=t.length)return!1;for(let a=0;a<e.length;a++)if(e.start(a)!=t.start(a)||e.end(a)!=t.end(a))return a=e.length,!1;return!0}(u.buffered,W)){de.clearRect(0,0,me.width,me.height);let e=me.width/u.duration;for(let t=0;t<u.buffered.length;t++){let a=u.buffered.start(t)*e,s=u.buffered.end(t)*e-a;new AmstRoundedRect(de,ue,a,s)}W=u.buffered}}me.height=ue,de.fillStyle=me.css("color");let pe=.5*L.offsetWidth;function ve(){let e=u.paused&&!u.seeking?"all .15s ease-in":"none",t=u.currentTime,a=u.duration,s=isNaN(a)?0:(t/a).toFixed(4),n=s*O-pe;n=Math.max(n,0),n=Math.min(n,O-2*pe)+"px",u.paused?(x.css({[transitionPrefix]:e,[transformPrefix]:`scaleX(${s})`}),L.css({[transitionPrefix]:e,[transformPrefix]:`translateX(${n})`})):(x.css({[transitionPrefix]:e,[transformPrefix]:`scaleX(${s})`}),L.css({[transitionPrefix]:e,[transformPrefix]:`translateX(${n})`}),S=requestAnimationFrame(ve))}function he(e){let t=((e.changedTouches?e.changedTouches[0].clientX:e.clientX)-B)/O;u.currentTime=t*u.duration}function _e(e){o.paused||q||Z({detail:{delayed:!0}}),he(e),T.off(myPointerMove,he),T.off(myPointerUp+" "+myPointerLeave,_e)}if(m([u,g,h,f]).on("touchstart",(function(e){const t=l(e.target),a=(new Date).getTime(),s=200,n=u.duration?u.currentTime/u.duration:void 0;let r=e.changedTouches[0].pageX,m=e.changedTouches[0].pageY,d=0,c=0,p=0,v=void 0,f=!1;function g(e){if(u.duration&&!(o.paused&&p<-5))if(f)e.preventDefault();else{if(p>-5&&e.preventDefault(),d=e.changedTouches[0].pageX-r,c=e.changedTouches[0].pageY-m,Math.abs(d)>Math.abs(c)?p++:p--,p>=5){v=Math.min(Math.max(n+d/M,0),.999),N||(N=_.offsetWidth);const e=Math.min(Math.max(v*M-.5*N,0),M-N)+"px";let t={[transformPrefix]:`translateX(${e})`};o.params.thumbnails.src&&(t.backgroundPosition=-Math.floor(100*v)*J+"px 0"),_.css(t),l(".amst__seeking-touch-cache").style[transformPrefix]=`scaleX(${v})`,l(".amst__seeking-touch > span").innerHTML=secondsToTimeCode(u.duration*v,u.duration>3600),5==p&&(h.classList.add("amst__show"),Z({detail:{delayed:!1,forced:!0}}))}-5==p&&(c<0?Y&&(ee(),f=!0):Y||(Z(),f=!0))}}t.on("touchend",(function e(n){null!=v?(u.currentTime=u.duration*v,h.classList.remove("amst__show"),ee()):f||s>(new Date).getTime()-a&&o.togglePlayPause();t.off("touchend",e);t.off("touchmove",g)}),!!i&&{passive:!0}),t.on("touchmove",g,!!i&&{passive:!1})}),!!i&&{passive:!1}),m([u,g]).on("click",()=>this.pause(),!1),c.on("touchstart mousedown",()=>{c.classList.remove("amst__keyboard-active")},!!i&&{passive:!0}),l(".amst__playpause").on("click",()=>this.togglePlayPause()),f.on("click",()=>this.play()),y.on(myPointerEnter,e=>{if("touch"==myPointerType||e.pointerType&&"touch"==e.pointerType)return!1;ee(),q=!0}).on(myPointerLeave,e=>{if("touch"==myPointerType||e.pointerType&&"touch"==e.pointerType)return!1;q=!1,Z({detail:{delayed:!0}})}),T.on(myPointerDown,()=>{if(isNaN(u.duration))return!1;T.on(myPointerMove,he,!!i&&{passive:!0}),T.on(myPointerUp+" "+myPointerLeave,_e,!1)},!!i&&{passive:!0}),throttle(myPointerMove,"optimizedPointerMove",E),E.on("optimizedPointerMove",e=>{if("touch"==myPointerType||e.pointerType&&"touch"==e.pointerType||isNaN(u.duration))return!1;D||(D=A.offsetWidth);let t=e.detail.clientX-B;const a=t/O,s=-Math.floor(100*a)*J+"px",n=.5*D-6;o.params.thumbnails.src&&(A.style.backgroundPosition=s+" 0"),l(".amst__cursor").style[transformPrefix]=`translateX(${t}px)`,t=Math.max(t,n),t=Math.min(t,O-n),l(".amst__seeking-wrapper").style[transformPrefix]=`translateX(${t}px)`,l(".amst__seeking > span").innerHTML=secondsToTimeCode(a*u.duration,u.duration>3600)}),u.on("volumechange",()=>{if(!IS_MOBILE){const e=parseInt(100*u.volume);k.setAttributes({"aria-valuenow":e,"aria-valuetext":e+"%"}),"horizontal"==r?l(".amst__volume-current").style.width=e+"%":l(".amst__volume-handle").style.bottom=e+"%"}0==u.volume?(u.muted=!0,I.setAttributes({title:o.params.volumeButton.label.unmute,"aria-label":o.params.volumeButton.label.unmute,class:"amst__unmute"})):(u.muted=!1,H=u.volume,I.classList.contains("amst__unmute")&&(I.removeAttribute("class"),I.setAttributes({title:o.params.volumeButton.label.mute,"aria-label":o.params.volumeButton.label.mute}))),storage&&o.params.volumeGroup>-1&&storage.setItem(`amst_volumegroup${o.params.volumeGroup}`,o.volume),o.params.volume=o.volume,o.params.volumeGroup>-1&&AmstramgramVideoPlayer.players.length>1&&AmstramgramVideoPlayer.players.forEach(e=>{e!=o&&e.params.volumeGroup==o.params.volumeGroup&&e.volume!=o.volume&&(e.volume=o.volume)})}),I.on("click",()=>{u.muted?(u.volume=H,u.muted=!1):(u.volume=0,u.muted=!0)}),!IS_MOBILE){k.on(myPointerDown,()=>{k.on(myPointerMove,e).on(myPointerLeave,t).on(myPointerUp,e).on(myPointerUp,t)});const e=function(e){let t;"horizontal"==r?(t=Math.max(0,e.clientX-C.left),t=(t/=C.width)>.96?1:t):(k.style.cursor="ns-resize",t=C.height-e.clientY+C.top,t=Math.max(0,Math.min(t,100))/100),o.volume=t},t=function(){k.off(myPointerMove,e).off(myPointerLeave,t).off(myPointerUp,e).off(myPointerUp,t),"vertical"==r&&(k.style.cursor="")};c.on("keydown",(function(e){switch(c.classList.add("amst__keyboard-active"),ee(),[37,38,39,40,77].includes(e.which)&&e.preventDefault(),e.which>36&&e.which<41&&(38!=e.which&&40!=e.which||d.activeElement==k||("vertical"==r?(k.on("transitionend",(function e(){this.removeEventListener("transitionend",e),this.focus()})),I.focus()):k.focus()),37!=e.which&&39!=e.which||d.activeElement==E||E.focus()),e.which){case 77:!0!==o.params.volumeButton.disabled&&!0!==o.params.volumeButton.hidden&&(I.dispatchEvent(new MouseEvent("click")),I.focus());break;case 40:!0!==o.params.volumeButton.disabled&&!0!==o.params.volumeButton.hidden&&(o.volume=Math.max(0,o.volume-.05));break;case 38:!0!==o.params.volumeButton.disabled&&!0!==o.params.volumeButton.hidden&&(o.volume=Math.min(1,o.volume+.05));break;case 37:o.currentTime=Math.max(0,o.currentTime-V);break;case 39:o.currentTime=Math.min(o.duration,o.currentTime+V);break;case 32:if(d.activeElement==P)return;"BUTTON"!=d.activeElement.nodeName&&(e.preventDefault(),o.togglePlayPause())}}),!1)}if(fullscreenAPI){let e=0,t=0;const a=l(".amst__fullscreen>button");a.on("click",()=>{null!==d[fullscreenAPI.fullscreenElement]?d[fullscreenAPI.exitFullscreen]():(e=w.pageXOffset,t=w.pageYOffset,n[fullscreenAPI.requestFullscreen](),AmstramgramVideoPlayer.currentFullScreenPlayer=o)}),d.addEventListener(fullscreenAPI.fullscreenchange,(function(){d[fullscreenAPI.fullscreenElement]==n?(w.addEventListener("optimizedResize",s),n.classList.add("amst__isfullscreen"),c.classList.add("amst__notransition"),a.setAttributes({title:R,"aria-label":R,class:" amst__unfullscreen"}),s()):AmstramgramVideoPlayer.currentFullScreenPlayer==o&&(w.removeEventListener("optimizedResize",s),c.setAttribute("style",`padding-bottom:${1/o.params.format*100}%`),n.classList.remove("amst__isfullscreen"),a.setAttributes({title:j,"aria-label":j,class:""}),setTimeout(()=>{w.scroll(e,t),setTimeout(()=>{c.classList.remove("amst__notransition")},50)},50),AmstramgramVideoPlayer.currentFullScreenPlayer=void 0)}),!1);const s=function(){w.innerWidth/w.innerHeight>o.params.format?c.css({width:w.innerHeight*o.params.format+"px",height:"100%",paddingBottom:0}):c.css({width:"100%",height:"auto",paddingBottom:1/o.params.format*100+"%"}),ge()}}function fe(){F&&clearTimeout(F),F=setTimeout((function(){$=0,m(".amst__controls>div:not(.amst__rail):not(.amst__hidden):not(.amst__time-duration)").forEach(e=>{e.classList.contains("amst__time")?$+=2*e.offsetWidth:$+=e.offsetWidth}),ge()}),1)}function ge(){(M=c.offsetWidth)-b-$<AmstramgramVideoPlayer.defaultOptions.railMinWidthForNormalUI?c.classList.add("amst__compact"):c.classList.remove("amst__compact");let e=E.getBoundingClientRect();if(B=e.left,O=e.width,ve(),!IS_MOBILE){const e=function(t){C=l(".amst__volume-total").getBoundingClientRect(),t&&t.target==c&&c.off("transitionend",e)};c.on("transitionend",e,!1),e()}}w.addEventListener("optimizedResize",ge),w.addEventListener("optimizedScroll",ge),"unknown"==_pointerType?c.addEventListener("pointerDetected",(function e(){c.removeEventListener("pointerDetected",e),"touch"!=_pointerType&&c.classList.add("amst__no-touch")}),!1):"touch"!=_pointerType&&c.classList.add("amst__no-touch"),AmstramgramVideoPlayer.players.push(this),t&&"function"==typeof t.onInit&&setTimeout((function(){t.onInit.call(o)}),0)}set src(e){this.container.dispatchEvent(new CustomEvent("amstEvent__src",{detail:e}))}get src(){return this.media.getAttribute("src")}get paused(){return this.media.paused}get duration(){return this.media.duration}set currentTime(e){this.media.duration&&e>=0&&e<=this.media.duration&&(this.media.currentTime=e)}get currentTime(){return this.media.currentTime}set volume(e){this.media.volume=e}get volume(){return this.media.volume}pause(){this.container.dispatchEvent(new CustomEvent("amstEvent__pause"))}play(){this.container.dispatchEvent(new CustomEvent("amstEvent__play"))}reset(){this.pause(),this.container.dispatchEvent(new CustomEvent("amstEvent__reset"))}togglePlayPause(){this.paused?this.play():this.pause()}hideControls(e=!1,t=!1){this.container.dispatchEvent(new CustomEvent("amstEvent__hideControls",{detail:{delayed:e,forced:t}}))}showControls(){this.container.dispatchEvent(new CustomEvent("amstEvent__showControls"))}previous(e){isObject(e)&&(this.params=mergeDeep(this.params,{previous:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__previousButton")))}next(e){isObject(e)&&(this.params=mergeDeep(this.params.next,{next:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__nextButton")))}fullscreen(e){isObject(e)&&(this.params=mergeDeep(this.params,{fullscreen:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__fullscreenButton")))}download(e){isObject(e)&&(this.params=mergeDeep(this.params,{download:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__downloadButton")))}volumeButton(e){isObject(e)&&(this.params=mergeDeep(this.params,{volumeButton:e}),this.container.dispatchEvent(new CustomEvent("amstEvent__volumeButton")))}on(e,t){"next"!=e&&"previous"!=e||this.events[e].push(t)}off(e,t){if("next"==e||"previous"==e){const a=this.events[e].indexOf(t);a>-1&&this.events[e].splice(a,1)}}}function buildUI(e){let t="",a="";IS_MOBILE||(a=`\n      <div class="amst__volume-slider" aria-label="${e.volumeSliderLabel}" aria-valuemin="0" aria-valuemax="100" aria-valuenow="100" aria-valuetext="100%" role="slider" aria-orientation="${e.videoVolumeOrientation}" tabindex="0" title="${e.volumeHelpLabel}">\n        <span class="amst__offscreen">${e.volumeHelpLabel}</span>\n        <div class="amst__volume-total">\n          <div class="amst__volume-current" style="height: 100%;"></div>`,"horizontal"!=e.videoVolumeOrientation&&(a+='<div class="amst__volume-handle" style="bottom: 100%; margin-bottom: -3px;"></div>'),a+="</div></div>"),t='\n    <div class="amst__button amst__volumebutton">\n      <button type="button" tabindex="0"></button>',"horizontal"!=e.videoVolumeOrientation?t+=a+"</div>":t+="</div>"+a;let s=`\n    <span class="amst__offscreen">${e.appLabel}</span>\n    <div class="amst__container" tabindex="0" role="application" aria-label="${e.appLabel}">\n      <div class="amst__mediaelement">\n        <video></video>\n      </div>\n    <div class="amst__layers">\n      <div class="amst__layer-poster">\n        <canvas></canvas>\n      </div>\n      <div class="amst__layer-loading">\n        <div class="amst__loading">\n          <span class="amst__svg"></span>\n        </div>\n      </div>\n      <div class="amst__layer-play">\n        <div class="amst__svg" role="button" tabindex="0" aria-label="${e.playLabel}" aria-pressed="false"></div>\n      </div>\n      <div class="amst__layer-seeking-touch">\n        <div class="amst__seeking-touch-cache"></div>\n        <span class="amst__time amst__seeking-touch">\n          <span></span>\n        </span>\n      </div>\n    </div>\n    <div class="amst__controls">\n      <div class="amst__button amst__previous">\n        <button type="button" title="${e.previous.label}" aria-label="${e.previous.label}" tabindex="0"></button>\n      </div>\n      <div class="amst__button amst__playpause">\n        <button type="button" title="${e.playLabel}" aria-label="${e.playLabel}" tabindex="0"></button>\n      </div>\n      <div class="amst__button amst__next">\n        <button type="button" title="${e.next.label}" aria-label="${e.next.label}" tabindex="0"></button>\n      </div>\n      <div class="amst__time" role="timer" aria-live="off">\n        <span class="amst__currenttime">00:00</span>\n      </div>\n      <div class="amst__rail">\n        <span class="amst__slider" role="slider" tabindex="0">\n          <span class="amst__buffering-bar"></span>\n          <canvas class="amst__loaded-bar"></canvas>\n          <span class="amst__currenttime-bar"></span>\n          <span class="amst__handle"><span></span></span>\n          <span class="amst__cursor"><span></span></span>\n          <span class="amst__seeking-wrapper">\n            <span class="amst__time amst__seeking">\n              <span>00:00</span>\n            </span>\n          </span>\n        </span>\n      </div>\n      <div class="amst__time amst__time-duration">\n        <span class="amst__duration">00:00</span>\n      </div>`;return s+=t,fullscreenAPI&&(s+=`        \n      <div class="amst__button amst__fullscreen">\n        <button type="button" title="${e.fullscreen.label}" aria-label="${e.fullscreen.label}" tabindex="0"></button>\n      </div>`),s+=`\n      <div class="amst__button amst__download">\n        <button type="button" title="${e.download.label}" aria-label="${e.download.label}" tabindex="0"></button>\n      </div>\n    </div>\n  `}function secondsToTimeCode(e,t){e=Math.round(e);let a=Math.floor(e/3600),s=Math.floor((e-3600*a)/60),n=Math.round(e%60);return(a=a>9?a+":":a>0?"0"+a+":":t?"00:":"")+(s=s>9?s:"0"+s)+":"+(n=n>9?n:"0"+n)}AmstramgramVideoPlayer.currentPlayer=void 0,AmstramgramVideoPlayer.players=[],AmstramgramVideoPlayer.defaultOptions={autoplay:!1,crossorigin:"anonymous",download:{label:"Télécharger",disabled:!1,hidden:!1},duration:120,format:16/9,fullscreen:{label:{enter:"Plein écran",exit:"Quitter le plein écran"},disabled:!1,hidden:!1},loop:!1,next:{label:"Suivant",disabled:!0,hidden:!0},playsinline:!0,poster:void 0,preload:"none",previous:{label:"Précédent",disabled:!0,hidden:!0},skipTime:"1%",thumbnails:{src:void 0,number:100},volume:.8,volumeButton:{label:{mute:"Désactiver le son",unmute:"Activer le son"},disabled:!1,hidden:!1},volumeGroup:0,hideControlsDelay:5e3,videoVolumeOrientation:"vertical",railMinWidthForNormalUI:600,appLabel:"Lecteur Vidéo",pauseLabel:"Pause",playLabel:"Lecture",volumeHelpLabel:"Utilisez les flèches Haut/Bas du clavier pour augmenter ou diminuer le volume.",volumeSliderLabel:"Potentiomètre de volume"};class AmstRoundedRect{constructor(e,t,a,s){e.beginPath(),e.moveTo(a+2,0),e.lineTo(a+s-2,0),e.quadraticCurveTo(a+s,0,a+s,2),e.lineTo(a+s,0+t-2),e.quadraticCurveTo(a+s,0+t,a+s-2,0+t),e.lineTo(a+2,0+t),e.quadraticCurveTo(a,0+t,a,0+t-2),e.lineTo(a,2),e.quadraticCurveTo(a,0,a+2,0),e.closePath(),e.fill()}}let throttle=(e,t,a=w)=>{let s=!1;a.addEventListener(e,e=>{s||(s=!0,requestAnimationFrame(()=>{a.dispatchEvent(new CustomEvent(t,{detail:e})),s=!1}))})};function isObject(e){return e&&"object"==typeof e&&!Array.isArray(e)}function mergeDeep(e,t){let a=Object.assign({},e);return isObject(e)&&isObject(t)&&Object.keys(t).forEach(s=>{isObject(t[s])&&s in e?a[s]=mergeDeep(e[s],t[s]):Object.assign(a,{[s]:t[s]})}),a}throttle("resize","optimizedResize"),throttle("scroll","optimizedScroll");let _$=e=>{return function(t){let a="string"==typeof t?e.querySelector(t):t;return a&&(a.css=e=>{if("string"==typeof e){let t=w.getComputedStyle(a,null).getPropertyValue(e);return isNaN(parseFloat(t))?t:parseFloat(t)}return Object.assign(a.style,e),a},a.setAttributes=e=>{Object.keys(e).forEach(t=>a.setAttribute(t,e[t]))},a.on=function(e,t,s=!1){return e.split(" ").forEach(e=>a.addEventListener(e,t,s)),a},a.off=function(e,t){return e.split(" ").forEach(e=>a.removeEventListener(e,t)),a}),a}},_$$=e=>{return t=>{let a=Array.isArray(t)?t:Array.from(e.querySelectorAll(t));return a.css=e=>{if("string"==typeof e){let t=window.getComputedStyle(a[0],null).getPropertyValue(e);return isNaN(parseFloat(t))?t:parseFloat(t)}return a.forEach(t=>{Object.assign(t.style,e)}),a},a.on=function(e,t,s=!1){return a.forEach(a=>{e.split(" ").forEach(e=>a.addEventListener(e,t,s))}),a},a.off=function(e,t){return a.forEach(a=>{e.split(" ").forEach(e=>a.removeEventListener(e,t))}),a},a.length?a:null}};module.exports=AmstramgramVideoPlayer;
